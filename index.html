<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Evexa Universal Converter: A versatile tool for students daily life, including image to PDF, PDF to image, text to PDF, resume builder, and a simple note taker.">
    <meta name="keywords" content="universal converter, image to PDF, PDF to image, text to PDF, resume builder, note taker, student tools, daily life tools">
    <title>Evexa Universal Converter</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* CSS Custom Properties (Variables) for easy theme management */
        :root {
            --primary-color: #6366f1; /* Indigo 500 - main accent */
            --secondary-accent: #a78bfa; /* Violet 400 - secondary accent/glow */
            --bg-dark: #1a202c; /* Dark charcoal */
            --bg-card: #2d3748; /* Darker gray for cards */
            --text-light: #e2e8f0; /* Light gray for general text */
            --text-muted: #a0aec0; /* Muted gray for placeholders/secondary text */
            --font-family: 'Inter', sans-serif; /* Modern sans-serif font */
            --border-radius: 0.75rem; /* Consistent border radius for elements */
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3), 0 0 10px rgba(99, 102, 241, 0.1); /* Soft shadow for depth */
            --note-bg-color: #3a445a; /* Background for individual notes */
            --note-delete-color: #ef4444; /* Red for note delete button */
            --note-delete-hover-color: #dc2626; /* Darker red on hover */
        }

        /* Universal box-sizing for consistent layout */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body styles - full height, flexbox for centering content */
        body {
            font-family: var(--font-family);
            background-color: var(--bg-dark);
            color: var(--text-light);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased; /* Smoother font rendering */
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden; /* Prevent horizontal scroll */
            min-height: 100vh; /* Ensure body takes full viewport height */
            display: flex;
            flex-direction: column;
        }

        /* Container for main content */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1.5rem;
            flex-grow: 1; /* Allow container to grow and push footer down */
        }

        /* Header styling */
        .app-header {
            background-color: var(--bg-dark); /* Using dark background for header */
            color: var(--text-light);
            padding: 0.75rem 1rem; /* Reduced padding for smaller height */
            text-align: center;
            box-shadow: var(--box-shadow);
            display: flex; /* Use flexbox for main header layout */
            align-items: center; /* Vertically align items in the center */
            gap: 1rem; /* Spacing between direct flex items */
            border-bottom: 1px solid #3a445a; /* Subtle border at the bottom */
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
            justify-content: center; /* Center items for mobile */
        }

        .app-header .logo-title-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .app-header .logo img {
            width: 35px; /* Slightly smaller logo */
            height: 35px;
            border-radius: var(--border-radius);
        }

        .app-header h1 {
            font-size: 1.8rem; /* Slightly smaller title */
            margin: 0;
            color: var(--text-light);
            font-weight: 800; /* Extra bold for tech feel */
        }

        /* Search bar styling */
        .search-container {
            display: flex;
            align-items: center;
            background-color: var(--bg-dark);
            border: 1px solid #4a5568;
            border-radius: 0.5rem;
            padding: 0.4rem 1rem; /* Adjusted padding */
            width: 100%; /* Full width on mobile */
            max-width: 300px; /* Limit width on desktop, will be overridden */
            position: relative; /* For search results dropdown */
            transition: all 0.3s ease; /* Smooth transition for width changes */
        }

        .search-container input {
            flex-grow: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-light);
            font-size: 0.95rem; /* Slightly smaller font */
            padding: 0;
        }

        .search-container input::placeholder {
            color: var(--text-muted);
        }

        .search-container .search-icon {
            color: var(--text-muted);
            margin-right: 0.75rem;
        }

        /* Navigation Tabs */
        .tab-nav {
            display: flex;
            flex-wrap: wrap; /* Allow tabs to wrap on smaller screens */
            justify-content: center; /* Center items on small screens */
            gap: 0.75rem; /* Spacing between tabs */
            position: relative; /* For positioning search results */
            flex-shrink: 0; /* Prevent shrinking */
            width: 100%; /* Full width on mobile */
        }

        .tab-button {
            background-color: var(--bg-card);
            color: var(--text-muted);
            padding: 0.6rem 1.2rem; /* Reduced padding for smaller buttons */
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent; /* Subtle border */
            flex-shrink: 0; /* Prevent buttons from shrinking too much */
            min-width: 100px; /* Minimum width for readability */
            text-align: center;
            display: flex; /* For icon and text alignment */
            align-items: center;
            justify-content: center;
            font-size: 0.95rem; /* Slightly smaller font size */
        }

        .tab-button.active {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-accent) 100%);
            color: white;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.6), 0 0 20px rgba(167, 139, 250, 0.4); /* Glowing effect */
            border-color: var(--primary-color);
        }

        .tab-button:hover:not(.active) {
            background-color: #3a445a; /* Slightly lighter on hover for inactive */
            color: var(--text-light);
            border-color: var(--primary-color);
        }

        /* Main content area styling (now handled by .container and .tab-content) */
        .app-main {
            flex-grow: 1; /* Allow main content to expand */
            max-width: 1200px; /* Consistent with .container */
            width: 90%;
            margin: 2rem auto;
            padding: 0; /* No padding here, cards will have padding */
        }

        /* Section titles */
        .section-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text-light);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .section-description {
            font-size: 1.1rem;
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 2rem;
        }

        /* Card styling (used for each converter section) */
        .card {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            color: var(--text-light);
            border: 1px solid #3a445a;
        }

        /* General form input styling */
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #4a5568;
            border-radius: 0.5rem;
            font-size: 1rem;
            background-color: var(--bg-dark);
            color: var(--text-light);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
        }
        .form-input::placeholder {
            color: var(--text-muted);
        }
        textarea.form-input {
            resize: vertical;
        }
        /* Specific style for form-textarea within the Text to PDF converter */
        .form-textarea {
            min-height: 120px; /* Increased min-height for better UX */
        }

        /* Button Styling (primary, secondary, clear) */
        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-accent) 100%);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        .btn-primary:hover {
            background: linear-gradient(90deg, #4f46e5 0%, #9068f0 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6);
        }
        .btn-primary:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            color: #cbd5e0;
        }

        .btn-secondary {
            background-color: #4a5568;
            color: var(--text-light);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
            cursor: pointer;
            border: none;
        }
        .btn-secondary:hover {
            background-color: #6366f1;
        }

        .btn-clear {
            background-color: var(--note-delete-color); /* Red 500 */
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }
        .btn-clear:hover {
            background-color: var(--note-delete-hover-color); /* Red 600 */
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
        }
        .btn-clear:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            color: #cbd5e0;
        }

        /* Link Button Style (Download) */
        .link-download {
            background-color: #10b981; /* Emerald-500 */
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        .link-download:hover {
            background-color: #059669; /* Emerald-600 */
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }

        /* Image Converter Specific Styles */
        .drop-area {
            border: 2px dashed var(--primary-color);
            background-color: #262c38;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .drop-area.highlight {
            background-color: #3a445a;
            border-color: var(--secondary-accent);
        }
        .drop-area:hover {
            background-color: #2d3748;
        }
        /* Pinterest-like grid for image previews */
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Adjusted minmax for better scaling */
            gap: 1rem;
            margin-top: 1.5rem;
            border: 1px solid #4a5568;
            background-color: var(--bg-dark);
            padding: 1rem;
            border-radius: 0.75rem;
            min-height: 150px;
            align-items: flex-start;
            justify-items: center;
        }
        .image-preview-item {
            position: relative;
            width: 100%; /* Take full width of grid column */
            padding-bottom: 100%; /* Maintain 1:1 aspect ratio */
            overflow: hidden;
            border: 1px solid #4a5568;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-card);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: grab;
            transition: transform 0.2s ease;
        }
        .image-preview-item:active {
            cursor: grabbing;
        }
        .image-preview-item img {
            position: absolute; /* Position image within padding-bottom container */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Ensure image fits without cropping */
        }
        .image-preview-item .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .image-preview-item .delete-btn:hover {
            opacity: 1;
            background-color: #dc2626;
        }

        /* PDF to Image specific drop area */
        .pdf-drop-area {
            border: 2px dashed var(--primary-color);
            background-color: #262c38;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
        }
        .pdf-drop-area.highlight {
            background-color: #3a445a;
            border-color: var(--secondary-accent);
        }
        .pdf-drop-area:hover {
            background-color: #2d3748;
        }
        .pdf-drop-area .selected-file-name {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Message Box Styling */
        .message-box {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: 500;
            text-align: left;
            border: 1px solid transparent;
        }
        .message-box.info {
            background-color: #34495e;
            color: var(--text-light);
            border-color: #5dade2;
        }
        .message-box.success {
            background-color: #1a5242;
            color: var(--text-light);
            border-color: #2ecc71;
        }
        .message-box.error {
            background-color: #641e1e;
            color: var(--text-light);
            border-color: #e74c3c;
        }
        .hidden {
            display: none;
        }

        /* Resume Builder Specific Styles */
        .template-card {
            background-color: var(--bg-card);
            color: var(--text-light);
            padding: 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
            border: 2px solid transparent;
        }
        .template-card.active {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-accent));
            border-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.4);
        }
        .template-card:hover:not(.active) {
            background-color: #3a445a;
            color: var(--text-light);
            border-color: var(--primary-color);
        }

        .section-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--bg-dark);
            border: 1px solid #4a5568;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            cursor: grab;
            transition: background-color 0.2s ease;
        }
        .section-item:hover {
            background-color: #2d3748;
        }
        .section-item:active {
            cursor: grabbing;
        }
        .sortable-ghost {
            opacity: 0.5;
            background-color: var(--primary-color);
            color: white;
        }
        .section-item .drag-handle {
            cursor: grab;
            margin-right: 10px;
            color: var(--text-muted);
        }
        .section-item .drag-handle:active {
            cursor: grabbing;
        }

        /* Resume Preview Area */
        #resume-preview-container {
            border: 1px solid #4a5568;
            background-color: var(--bg-dark);
            min-height: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 0.75rem;
            padding: 2rem;
            color: #2d3748;
        }

        #resume-preview {
            background-color: white;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 800px;
            max-width: 210mm;
            margin: auto;
            box-sizing: border-box;
            word-wrap: break-word;
        }

        /* Resume Template Styles */
        .resume-template h1, .resume-template h2, .resume-template h3 {
            color: var(--primary-color);
            font-family: var(--font-family);
            margin-bottom: 0.5rem;
        }
        .resume-template h1 { font-size: 2.2rem; margin-bottom: 0.25rem; }
        .resume-template h2 { font-size: 1.5rem; margin-bottom: 0.75rem; border-bottom: 2px solid var(--primary-color); padding-bottom: 0.25rem; }
        .resume-template h3 { font-size: 1.2rem; margin-bottom: 0.5rem; }
        .resume-template p, .resume-template ul, .resume-template li {
            font-family: var(--font-family);
            font-size: 0.95rem;
            line-height: 1.5;
            color: #333; /* Darker text for readability on white background */
        }
        .resume-template ul {
            list-style-type: var(--bullet-type, disc);
            padding-left: 20px;
            margin-bottom: 1rem;
            line-height: var(--list-line-height, 1.5);
        }
        .resume-template ul.skills-list { display: flex; flex-wrap: wrap; list-style: none; padding-left: 0;}
        .resume-template ul.skills-list li { margin-right: 10px; margin-bottom: 5px; background-color: #e2e8f0; padding: 3px 8px; border-radius: 5px; font-size: 0.85rem;}

        /* Modern Template */
        .resume-template.modern .header-section {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        .resume-template.modern .header-section h1 {
            color: white;
            margin-bottom: 5px;
            font-size: 2.5rem;
        }
        .resume-template.modern .header-section p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }
        .resume-template.modern .contact-info span {
            margin: 0 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }
        .resume-template.modern h2 {
            text-align: left;
            border-bottom-color: var(--primary-color);
            margin-top: 1.5rem;
            font-size: 1.6rem;
        }
        .resume-template.modern .section-content h3 {
            color: #444; /* Darker secondary text */
            margin-top: 1rem;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }
        .resume-template.modern .meta-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        /* Classic Template */
        .resume-template.classic .header-section {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px double var(--primary-color);
            padding-bottom: 10px;
        }
        .resume-template.classic .header-section h1 {
            color: #2d3748;
            font-size: 2.8rem;
            margin-bottom: 5px;
        }
        .resume-template.classic .header-section p {
            color: #4a5568;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        .resume-template.classic .contact-info span {
            margin: 0 8px;
            color: #4a5568;
            font-size: 0.95rem;
        }
        .resume-template.classic h2 {
            text-align: left;
            border-bottom-color: #ccc;
            margin-top: 1.5rem;
            font-size: 1.6rem;
            color: #2d3748;
        }
        .resume-template.classic .section-content h3 {
            color: #2d3748;
            margin-top: 1rem;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }
        .resume-template.classic .meta-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
            font-style: italic;
        }

        /* Minimal Template */
        .resume-template.minimal .header-section {
            text-align: left;
            margin-bottom: 25px;
        }
        .resume-template.minimal .header-section h1 {
            color: #2d3748;
            font-size: 2.8rem;
            margin-bottom: 5px;
            border-left: 5px solid var(--primary-color);
            padding-left: 10px;
            display: inline-block;
        }
        .resume-template.minimal .header-section p {
            color: #4a5568;
            font-size: 1.2rem;
            margin-top: 5px;
            margin-left: 15px; /* Align with h1 padding */
        }
        .resume-template.minimal .contact-info {
            margin-top: 10px;
            margin-left: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px 20px;
        }
        .resume-template.minimal .contact-info span {
            color: #4a5568;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
        }
        .resume-template.minimal .contact-info span svg {
            margin-right: 5px;
            width: 16px;
            height: 16px;
            fill: var(--primary-color);
        }
        .resume-template.minimal h2 {
            text-align: left;
            border-bottom: none;
            position: relative;
            margin-top: 1.5rem;
            font-size: 1.6rem;
            color: #2d3748;
        }
        .resume-template.minimal h2::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 50px;
            height: 2px;
            background-color: var(--primary-color);
        }
        .resume-template.minimal .section-content h3 {
            color: var(--primary-color);
            margin-top: 1rem;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }
        .resume-template.minimal .meta-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        .resume-template.minimal ul {
            list-style-type: var(--bullet-type, circle); /* Minimal template default is circle, so we set it here */
        }

        /* New styles for Projects section */
        .resume-section.projects-section {
            margin-bottom: 25px; /* Spacing below the entire projects section */
        }

        .project-item {
            margin-bottom: 15px; /* Spacing between individual projects */
        }

        .project-item h4 {
            font-size: 1.15rem; /* Project title size */
            font-weight: 600;
            color: var(--primary-color); /* Use primary color if defined */
            margin-bottom: 5px;
        }

        .project-item .project-date {
            font-size: 0.9rem;
            color: #b0b0b0;
            margin-bottom: 5px;
        }

        .project-item .project-description {
            font-size: 1rem;
            color: #e0e0e0;
            line-height: var(--list-line-height); /* Use global list line height */
        }

        .project-item .project-link {
            font-size: 0.9rem;
            color: #7dd3fc; /* A link color */
            text-decoration: underline;
            margin-top: 5px;
            display: block;
        }

        /* --- New Note Taker Section Styles --- */
        .note-taker-section {
            margin-top: 2rem;
        }

        .note-input {
            min-height: 120px;
            margin-bottom: 1rem;
            resize: vertical;
        }

        .save-note-button {
            width: 100%;
            margin-bottom: 2rem;
        }

        .saved-notes-container {
            background-color: var(--bg-dark);
            border: 1px solid #4a5568;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .saved-notes-container h3 {
            font-size: 1.4rem;
            color: var(--text-light);
            margin-bottom: 1rem;
            text-align: center;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 0.5rem;
        }

        .notes-list {
            list-style: none;
            padding: 0;
        }

        .note-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            background-color: var(--note-bg-color);
            border: 1px solid #5a647a;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.8rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .note-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        }

        .note-text {
            flex-grow: 1;
            font-size: 1rem;
            color: var(--text-light);
            margin-right: 1rem;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .delete-note-button {
            background-color: var(--note-delete-color);
            color: white;
            border: none;
            border-radius: 0.375rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            flex-shrink: 0;
        }

        .delete-note-button:hover {
            background-color: var(--note-delete-hover-color);
            transform: scale(1.05);
        }

        .delete-note-button i {
            font-size: 1rem;
        }

        .no-notes-message {
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
            padding: 1rem;
        }

        /* New button style for adding dynamic sections */
        .btn-add-dynamic {
            background-color: #34d399; /* Green-400 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 2px 5px rgba(52, 211, 153, 0.3);
        }
        .btn-add-dynamic:hover {
            background-color: #10b981; /* Green-500 */
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(52, 211, 153, 0.5);
        }

        /* New button style for removing dynamic entries */
        .btn-remove-entry {
            background-color: #ef4444; /* Red-500 */
            color: white;
            border: none;
            border-radius: 50%; /* Circular button */
            width: 28px;
            height: 28px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            position: absolute; /* Position relative to parent dynamic entry div */
            top: 0.75rem; /* Adjust as needed */
            right: 0.75rem; /* Adjust as needed */
            z-index: 5; /* Ensure it's above inputs */
        }
        .btn-remove-entry:hover {
            background-color: #dc2626; /* Red-600 */
            transform: scale(1.1);
        }

        /* Resume Builder specific spacing adjustments */
        .resume-builder-section .card > div.mb-6 { /* Targets the main content blocks within the card */
            margin-bottom: 2.5rem; /* Increased spacing between major sections */
        }

        .resume-builder-section .card h4.text-lg.font-semibold.text-gray-300.mb-3,
        .resume-builder-section .card h4.flex {
            margin-bottom: 1.5rem; /* Increased spacing below section titles */
            padding-bottom: 0.75rem; /* Added padding for visual separation */
            border-bottom: 1px solid #4a5568; /* Subtle line below title */
        }
        .resume-builder-section .space-y-4 > div {
            margin-bottom: 1.25rem !important; /* Consistent spacing between dynamic entries */
        }
        .resume-builder-section .btn-add-dynamic {
            margin-left: 1rem; /* Space between title and add button */
        }

        /* Specific spacing for "Add New Project" and "Live Preview" */
        .resume-builder-section .mb-8.p-4.border { /* "Add New Project" container */
            margin-top: 2.5rem; /* Space above "Add New Project" */
            margin-bottom: 2.5rem; /* Space below "Add New Project" */
        }

        .resume-builder-section .mt-8 { /* "Live Preview" container */
            margin-top: 2.5rem; /* Space above "Live Preview" */
        }

        /* Spacing for Generate Resume PDF button */
        #generate-resume-pdf-btn {
            margin-top: 2.5rem; /* Space above the button */
            margin-bottom: 1.5rem; /* Space below the button */
        }

        /* Spacing for "Download Resume PDF" link */
        #download-resume-pdf-link {
            margin-top: 0.5rem; /* Closer to generate button */
            margin-bottom: 1.5rem; /* Space below download link */
        }

        /* Spacing for "Add Project Details" and "Save/Cancel" buttons */
        #toggle-project-form-btn {
            margin-bottom: 1.5rem; /* Space below the "Add Project Details" button */
        }
        #project-input-form .mb-4 { /* Last input in project form */
            margin-bottom: 1.5rem;
        }
        #project-input-form button { /* Save/Cancel buttons */
            margin-top: 1rem; /* Space above the buttons */
        }

        /* Dropdown specific styles for navigation */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px); /* Start slightly below */
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
            position: absolute;
            background-color: var(--bg-card);
            min-width: 160px;
            box-shadow: var(--box-shadow);
            z-index: 10;
            border-radius: var(--border-radius);
            padding: 0.5rem 0;
            left: 0;
            top: calc(100% + 0.5rem);
            border: 1px solid #3a445a;
            flex-direction: column;
            align-items: stretch;
            display: flex;
        }

        /* Show the dropdown menu on hover */
        .dropdown:hover .dropdown-content:not(.search-active) {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Show the dropdown menu when 'show-dropdown' class is present (for click toggle) */
        .dropdown-content.show-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Footer styling */
        .app-footer {
            background-color: var(--bg-dark);
            color: var(--text-muted);
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
            font-size: 0.9rem;
            border-top: 1px solid #3a445a;
        }

        /* New styles for dynamic entry fields grouping */
        .dynamic-entry-fields {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem; /* Space between inputs within a dynamic entry */
        }
        .dynamic-entry-fields label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
            display: block;
        }

        /* Collapsible section styles */
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.expanded {
            max-height: 1000px; /* Arbitrary large value to allow content to expand */
            transition: max-height 0.5s ease-in;
        }

        /* Search results dropdown */
        .search-results-dropdown {
            position: absolute;
            top: calc(100% + 5px); /* Position below search bar */
            left: 0;
            right: 0;
            background-color: var(--bg-card);
            border: 1px solid #4a5568;
            border-radius: 0.5rem;
            box-shadow: var(--box-shadow);
            z-index: 20; /* Above other content */
            max-height: 300px;
            overflow-y: auto;
            display: none; /* Hidden by default */
        }

        .search-results-dropdown.show {
            display: block;
        }

        .search-results-dropdown .search-result-item {
            padding: 0.75rem 1rem;
            color: var(--text-light);
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-results-dropdown .search-result-item:hover {
            background-color: #3a445a;
        }

        /* Responsive adjustments */
        @media (min-width: 768px) { /* Medium screens and up (Laptop View) */
            .app-header {
                flex-direction: row; /* Layout in a row */
                justify-content: space-between; /* Distribute items */
                padding: 0.5rem 1.5rem; /* Further reduced padding */
                flex-wrap: nowrap; /* Prevent wrapping on desktop */
            }

            .app-header .logo-title-group {
                margin-right: 1rem; /* Space between logo and search */
            }

            .app-header h1 {
                font-size: 1.6rem; /* Adjust for single line */
            }

            .app-header .logo img {
                width: 30px;
                height: 30px;
            }

            .search-container {
                flex-grow: 1; /* Search bar takes available space */
                max-width: 500px; /* Max width for search bar on desktop */
                margin-left: 0; /* Reset margins */
                margin-right: 0;
                order: 2; /* Order search bar after logo-title-group */
            }

            .tab-nav {
                margin-left: 1rem; /* Space between search and nav */
                margin-top: 0; /* Remove top margin */
                justify-content: flex-end; /* Ensure buttons are aligned to the right within nav */
                gap: 0.5rem; /* Smaller gap between buttons */
                width: auto; /* Allow nav to shrink to content */
                order: 3; /* Order nav after search bar */
            }

            .tab-button {
                padding: 0.5rem 1rem; /* Further reduced padding */
                font-size: 0.9rem; /* Further reduced font size */
                min-width: unset; /* Remove min-width for more compact buttons */
            }

            .dropdown-content {
                position: absolute; /* Revert to absolute positioning for desktop */
                top: calc(100% + 0.5rem);
                left: 0;
                width: auto; /* Adjust width based on content */
                min-width: 160px;
                box-shadow: var(--box-shadow);
                border: 1px solid #3a445a;
                border-radius: var(--border-radius);
            }

            .dropdown-content .tab-button {
                width: 100%;
                text-align: left;
                padding: 0.75rem 1rem;
                border-radius: 0;
            }
        }

        @media (max-width: 767px) { /* Mobile specific adjustments (Android App Look) */
            .app-header {
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
                padding: 1rem;
            }
            .app-header .logo-title-group {
                margin-bottom: 1rem;
                margin-right: 0; /* Reset auto margin */
            }
            .search-container {
                margin-bottom: 1rem;
                max-width: 100%; /* Full width on small screens */
                margin-left: 0; /* Reset auto margins */
                margin-right: 0;
                order: unset; /* Reset order for mobile */
            }
            .tab-nav {
                flex-direction: column;
                align-items: stretch;
                margin-top: 0;
                margin-left: 0; /* Reset auto margin */
                width: 100%;
            }
            .tab-button {
                width: 100%;
                max-width: none;
                margin-bottom: 0.5rem; /* Add spacing between stacked buttons */
            }
            .dropdown-content {
                position: static; /* Stack dropdown content below the button */
                width: 100%;
                box-shadow: none;
                border: none;
                border-radius: 0;
                padding: 0;
            }
            .dropdown-content .tab-button {
                min-width: unset;
                margin-bottom: 0.5rem; /* Spacing for sub-tabs */
            }
            .dropdown-content .tab-button:last-child {
                margin-bottom: 0; /* No margin after last sub-tab */
            }
        }

        @media (max-width: 480px) {
            .app-header h1 {
                font-size: 1.5rem;
            }
            .app-header .logo img {
                width: 25px;
                height: 25px;
            }
            .section-title {
                font-size: 1.8rem;
            }
            .btn-primary, .link-download {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }
            .form-textarea {
                min-height: 100px;
            }
            .note-item {
                padding: 0.8rem;
            }
            .note-text {
                font-size: 0.9rem;
            }
            .image-preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }

        /* Motivational Journal Specific Styles */
        .journal-entry-item {
            background-color: var(--note-bg-color);
            border: 1px solid #5a647a;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.8rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }
        .journal-entry-item h4 {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 0.25rem;
        }
        .journal-entry-item p {
            font-size: 0.95rem;
            color: var(--text-light);
            white-space: pre-wrap;
            word-break: break-word;
        }
        .journal-entry-item.locked {
            background-color: #2a303c;
            border-color: #3a445a;
        }
        .journal-entry-item.locked p {
            color: var(--text-muted);
        }
    </style>
</head>
<body class="antialiased">
    <header class="app-header">
        <div class="logo-title-group">
            <div class="logo">
                <img src="https://placehold.co/60x60/333/FFF?text=EV" alt="Evexa Logo">
            </div>
            <h1>EVE<span style="color: var(--secondary-accent);">X</span>A Converter</h1>
        </div>
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search-bar" placeholder="Search tools...">
            <div id="search-results-dropdown" class="search-results-dropdown">
                </div>
        </div>
        <nav class="tab-nav">
            <div class="dropdown">
                <button class="tab-button dropbtn" data-tab="pdf-tools-group" data-label="All PDF Solutions">
                    All PDF Solutions <i class="fas fa-caret-down ml-2"></i>
                </button>
                <div class="dropdown-content">
                    <button class="tab-button sub-tab-button" data-tab="image-to-pdf-section" data-label="Image to PDF">
                        <i class="fas fa-image mr-2"></i> Image to PDF
                    </button>
                    <button class="tab-button sub-tab-button" data-tab="pdf-to-image-section" data-label="PDF to Image">
                        <i class="fas fa-file-image mr-2"></i> PDF to Image
                    </button>
                    <button class="tab-button sub-tab-button" data-tab="text-to-pdf-section" data-label="Text to PDF">
                        <i class="fas fa-file-alt mr-2"></i> Text to PDF
                    </button>
                    <hr class="border-gray-600 my-2">
                    <button class="tab-button sub-tab-button" data-tab="rotate-pdf-section" data-label="Rotate PDF">
                        <i class="fas fa-redo-alt mr-2"></i> Rotate PDF
                    </button>
                    <button class="tab-button sub-tab-button" data-tab="add-page-numbers-section" data-label="Add Page Numbers">
                        <i class="fas fa-sort-numeric-down mr-2"></i> Add Page Numbers
                    </button>
                    <button class="tab-button sub-tab-button" data-tab="add-watermark-section" data-label="Add Watermark">
                        <i class="fas fa-tint mr-2"></i> Add Watermark
                    </button>
                    <button class="tab-button sub-tab-button" data-tab="crop-pdf-section" data-label="Crop PDF">
                        <i class="fas fa-crop-alt mr-2"></i> Crop PDF
                    </button>
                    <button class="tab-button sub-tab-button" data-tab="add-text-to-pdf-section" data-label="Add Text to PDF">
                        <i class="fas fa-font mr-2"></i> Add Text to PDF
                    </button>
                </div>
            </div>
            <button class="tab-button" data-tab="resume-builder-section" data-label="Resume Builder">Resume Builder</button>
            <button class="tab-button" data-tab="note-taker-section" data-label="Note Taker">Note Taker</button>
            <button class="tab-button" data-tab="motivational-journal-section" data-label="Motivational Journal">Motivational Journal</button>
        </nav>
    </header>

    <main class="container">
        <div id="image-to-pdf-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">Image to PDF Converter</h2>
                    <button id="clear-img-pdf-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Convert your images (JPG, PNG, WebP, GIF, BMP) into a single PDF document.</p>

                <div id="drop-area" class="drop-area text-gray-400">
                    <input type="file" id="image-input" accept="image/jpeg, image/png, image/webp, image/gif, image/bmp" multiple class="hidden">
                    <p class="text-lg font-semibold mb-2">Drag & Drop Images Here</p>
                    <p class="mb-4">or</p>
                    <button type="button" onclick="document.getElementById('image-input').click()" class="btn-primary">
                        <i class="fas fa-upload"></i> Select Images
                    </button>
                </div>

                <div id="loading-message-img-pdf" class="message-box info hidden">
                    <p><i class="fas fa-spinner fa-spin"></i> Processing images...</p>
                </div>
                <div id="status-message-img-pdf" class="message-box hidden"></div>

                <div id="image-previews-container" class="mt-8 hidden">
                    <h3 class="text-xl font-semibold mb-3 text-gray-300">Arrange Images (Drag & Drop)</h3>
                    <div id="image-previews" class="image-preview-grid">
                        </div>
                </div>

                <div class="mt-8 p-4 border border-gray-700 rounded-md bg-gray-800">
                    <h3 class="text-xl font-semibold mb-3 text-gray-300">PDF Output Options</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="pdf-page-size" class="block text-gray-400 font-medium mb-1 text-left">Page Size:</label>
                            <select id="pdf-page-size" class="form-input">
                                <option value="a4">A4 (210 x 297 mm)</option>
                                <option value="letter">Letter (216 x 279 mm)</option>
                                <option value="legal">Legal (216 x 356 mm)</option>
                            </select>
                        </div>
                        <div>
                            <label for="pdf-orientation" class="block text-gray-400 font-medium mb-1 text-left">Orientation:</label>
                            <select id="pdf-orientation" class="form-input">
                                <option value="p">Portrait</option>
                                <option value="l">Landscape</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="text-md font-semibold mb-2 text-gray-300 text-left">Margins (mm):</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <div>
                                <label for="margin-top" class="block text-gray-400 text-sm mb-1">Top:</label>
                                <input type="number" id="margin-top" value="10" min="0" class="form-input">
                            </div>
                            <div>
                                <label for="margin-right" class="block text-gray-400 text-sm mb-1">Right:</label>
                                <input type="number" id="margin-right" value="10" min="0" class="form-input">
                            </div>
                            <div>
                                <label for="margin-bottom" class="block text-gray-400 text-sm mb-1">Bottom:</label>
                                <input type="number" id="margin-bottom" value="10" min="0" class="form-input">
                            </div>
                            <div>
                                <label for="margin-left" class="block text-gray-400 text-sm mb-1">Left:</label>
                                <input type="number" id="margin-left" value="10" min="0" class="form-input">
                            </div>
                        </div>
                    </div>
                </div>

                <button id="convert-btn-img-pdf" class="btn-primary w-full mt-8 hidden" disabled>
                    <i class="fas fa-file-pdf"></i> Convert to PDF
                </button>

                <a id="download-link-img-pdf" class="link-download hidden" download="converted_images.pdf">
                    <i class="fas fa-download"></i> Download PDF
                </a>
            </div>
        </div>

        <div id="pdf-to-image-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">PDF to Image Converter</h2>
                    <button id="clear-pdf-img-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Extract pages from a PDF document as individual image files.</p>

                <input type="file" id="pdf-input" accept="application/pdf" class="hidden">

                <div id="pdf-drop-area" class="pdf-drop-area text-gray-400">
                    <i class="fas fa-file-pdf text-primary-color text-4xl mb-2"></i>
                    <p class="text-lg font-semibold mb-1">Drag & Drop PDF Here</p>
                    <p class="mb-2">or</p>
                    <button type="button" onclick="document.getElementById('pdf-input').click()" class="btn-primary px-6 py-2 text-base">
                        <i class="fas fa-upload"></i> Select PDF
                    </button>
                    <span id="selected-pdf-name" class="selected-file-name mt-2">No file chosen</span>
                </div>

                <div class="flex flex-col sm:flex-row sm:space-x-4 mb-4">
                    <div class="flex-1 mb-4 sm:mb-0">
                        <label for="output-format" class="block text-gray-300 text-left text-sm font-semibold mb-1">Output Format:</label>
                        <select id="output-format" class="form-input">
                            <option value="jpeg">JPG</option>
                            <option value="png">PNG</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="resolution-scale" class="block text-gray-300 text-left text-sm font-semibold mb-1">Download Quality:</label>
                        <select id="resolution-scale" class="form-input">
                            <option value="1.5">Normal Quality</option>
                            <option value="2">Standard Quality</option>
                            <option value="4">High Quality</option>
                        </select>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row sm:space-x-4 mb-6">
                    <div class="flex-1 mb-4 sm:mb-0">
                        <label for="page-start" class="block text-gray-300 text-left text-sm font-semibold mb-1">Start Page (optional):</label>
                        <input type="number" id="page-start" min="1" placeholder="e.g., 1" class="form-input">
                    </div>
                    <div class="flex-1">
                        <label for="page-end" class="block text-gray-300 text-left text-sm font-semibold mb-1">End Page (optional):</label>
                        <input type="number" id="page-end" min="1" placeholder="e.g., 5" class="form-input">
                    </div>
                </div>

                <button id="convert-pdf-to-img-btn" class="btn-primary w-full" disabled>
                    <i class="fas fa-images"></i> Convert PDF to Images
                </button>

                <div id="loading-message-pdf-img" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Converting PDF...</p>
                </div>
                <div id="status-message-pdf-img" class="message-box hidden"></div>

                <div id="pdf-image-output" class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden">
                    </div>

                <button id="download-all-images-btn" class="btn-primary w-full mt-8 hidden">
                    <i class="fas fa-file-archive"></i> Download All Images as ZIP
                </button>
            </div>
        </div>

        <div id="text-to-pdf-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">Text to PDF Converter</h2>
                    <button id="clear-text-pdf-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Convert plain text into a PDF document.</p>

                <div class="mb-4">
                    <label for="text-to-pdf-input" class="block text-gray-300 text-left text-sm font-semibold mb-1">Enter your text:</label>
                    <textarea id="text-to-pdf-input" class="form-input form-textarea" rows="10" placeholder="Start typing or paste your text here..."></textarea>
                </div>

                <button id="convert-text-to-pdf-btn" class="btn-primary w-full">
                    <i class="fas fa-file-pdf"></i> Convert Text to PDF
                </button>

                <div id="loading-message-text-pdf" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Generating PDF from text...</p>
                </div>
                <div id="status-message-text-pdf" class="message-box hidden"></div>

                <a id="download-text-pdf-link" class="link-download hidden" download="converted_text.pdf">
                    <i class="fas fa-download"></i> Download Text PDF
                </a>
            </div>
        </div>

        <div id="rotate-pdf-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">Rotate PDF</h2>
                    <button id="clear-rotate-pdf-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Rotate pages of your PDF document by 90, 180, or 270 degrees.</p>

                <input type="file" id="rotate-pdf-input" accept="application/pdf" class="hidden">
                <div id="rotate-pdf-drop-area" class="pdf-drop-area text-gray-400">
                    <i class="fas fa-file-pdf text-primary-color text-4xl mb-2"></i>
                    <p class="text-lg font-semibold mb-1">Drag & Drop PDF Here</p>
                    <p class="mb-2">or</p>
                    <button type="button" onclick="document.getElementById('rotate-pdf-input').click()" class="btn-primary px-6 py-2 text-base">
                        <i class="fas fa-upload"></i> Select PDF
                    </button>
                    <span id="selected-rotate-pdf-name" class="selected-file-name mt-2">No file chosen</span>
                </div>

                <div class="mb-4">
                    <label for="rotation-degree" class="block text-gray-300 text-left text-sm font-semibold mb-1">Rotation Degree:</label>
                    <select id="rotation-degree" class="form-input">
                        <option value="90">90 Degrees</option>
                        <option value="180">180 Degrees</option>
                        <option value="270">270 Degrees</option>
                    </select>
                </div>

                <button id="rotate-pdf-btn" class="btn-primary w-full" disabled>
                    <i class="fas fa-redo-alt"></i> Rotate PDF
                </button>

                <div id="loading-message-rotate-pdf" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Rotating PDF...</p>
                </div>
                <div id="status-message-rotate-pdf" class="message-box hidden"></div>

                <a id="download-rotate-pdf-link" class="link-download hidden" download="rotated_document.pdf">
                    <i class="fas fa-download"></i> Download Rotated PDF
                </a>
            </div>
        </div>

        <div id="add-page-numbers-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">Add Page Numbers</h2>
                    <button id="clear-page-numbers-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Add customizable page numbers to your PDF document.</p>

                <input type="file" id="page-numbers-pdf-input" accept="application/pdf" class="hidden">
                <div id="page-numbers-pdf-drop-area" class="pdf-drop-area text-gray-400">
                    <i class="fas fa-file-pdf text-primary-color text-4xl mb-2"></i>
                    <p class="text-lg font-semibold mb-1">Drag & Drop PDF Here</p>
                    <p class="mb-2">or</p>
                    <button type="button" onclick="document.getElementById('page-numbers-pdf-input').click()" class="btn-primary px-6 py-2 text-base">
                        <i class="fas fa-upload"></i> Select PDF
                    </button>
                    <span id="selected-page-numbers-pdf-name" class="selected-file-name mt-2">No file chosen</span>
                </div>

                <div class="mb-4">
                    <label for="page-number-format" class="block text-gray-300 text-left text-sm font-semibold mb-1">Format:</label>
                    <input type="text" id="page-number-format" class="form-input" value="Page {n} of {total}" placeholder="e.g., Page {n} of {total}">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="page-number-position" class="block text-gray-300 text-left text-sm font-semibold mb-1">Position:</label>
                        <select id="page-number-position" class="form-input">
                            <option value="bottom-center">Bottom Center</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="top-center">Top Center</option>
                            <option value="top-left">Top Left</option>
                            <option value="top-right">Top Right</option>
                        </select>
                    </div>
                    <div>
                        <label for="page-number-font-size" class="block text-gray-300 text-left text-sm font-semibold mb-1">Font Size (px):</label>
                        <input type="number" id="page-number-font-size" class="form-input" value="10" min="8" max="72">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="page-number-color" class="block text-gray-300 text-left text-sm font-semibold mb-1">Color:</label>
                        <input type="color" id="page-number-color" class="form-input h-10" value="#000000">
                    </div>
                    <div>
                        <label for="page-number-start" class="block text-gray-300 text-left text-sm font-semibold mb-1">Start Page (optional):</label>
                        <input type="number" id="page-number-start" min="1" placeholder="e.g., 1" class="form-input">
                    </div>
                    <div>
                        <label for="page-number-end" class="block text-gray-300 text-left text-sm font-semibold mb-1">End Page (optional):</label>
                        <input type="number" id="page-number-end" min="1" placeholder="e.g., 5" class="form-input">
                    </div>
                </div>

                <button id="add-page-numbers-btn" class="btn-primary w-full" disabled>
                    <i class="fas fa-sort-numeric-down"></i> Add Page Numbers
                </button>

                <div id="loading-message-page-numbers" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Adding page numbers...</p>
                </div>
                <div id="status-message-page-numbers" class="message-box hidden"></div>

                <a id="download-page-numbers-link" class="link-download hidden" download="numbered_document.pdf">
                    <i class="fas fa-download"></i> Download Numbered PDF
                </a>
            </div>
        </div>

        <div id="add-watermark-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">Add Watermark</h2>
                    <button id="clear-watermark-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Add a text watermark to your PDF document.</p>

                <input type="file" id="watermark-pdf-input" accept="application/pdf" class="hidden">
                <div id="watermark-pdf-drop-area" class="pdf-drop-area text-gray-400">
                    <i class="fas fa-file-pdf text-primary-color text-4xl mb-2"></i>
                    <p class="text-lg font-semibold mb-1">Drag & Drop PDF Here</p>
                    <p class="mb-2">or</p>
                    <button type="button" onclick="document.getElementById('watermark-pdf-input').click()" class="btn-primary px-6 py-2 text-base">
                        <i class="fas fa-upload"></i> Select PDF
                    </button>
                    <span id="selected-watermark-pdf-name" class="selected-file-name mt-2">No file chosen</span>
                </div>

                <div class="mb-4">
                    <label for="watermark-text" class="block text-gray-300 text-left text-sm font-semibold mb-1">Watermark Text:</label>
                    <input type="text" id="watermark-text" class="form-input" placeholder="e.g., CONFIDENTIAL">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="watermark-font-size" class="block text-gray-300 text-left text-sm font-semibold mb-1">Font Size (px):</label>
                        <input type="number" id="watermark-font-size" class="form-input" value="48" min="10" max="200">
                    </div>
                    <div>
                        <label for="watermark-color" class="block text-gray-300 text-left text-sm font-semibold mb-1">Color:</label>
                        <input type="color" id="watermark-color" class="form-input h-10" value="#CCCCCC">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="watermark-opacity" class="block text-gray-300 text-left text-sm font-semibold mb-1">Opacity (%):</label>
                        <input type="range" id="watermark-opacity" class="w-full h-10" min="0" max="100" value="20">
                        <span id="watermark-opacity-value" class="text-gray-400 text-sm mt-1 block text-right">20%</span>
                    </div>
                    <div>
                        <label for="watermark-position" class="block text-gray-300 text-left text-sm font-semibold mb-1">Position:</label>
                        <select id="watermark-position" class="form-input">
                            <option value="diagonal">Diagonal</option>
                            <option value="center">Center</option>
                        </select>
                    </div>
                </div>

                <button id="add-watermark-btn" class="btn-primary w-full" disabled>
                    <i class="fas fa-tint"></i> Add Watermark
                </button>

                <div id="loading-message-watermark" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Adding watermark...</p>
                </div>
                <div id="status-message-watermark" class="message-box hidden"></div>

                <a id="download-watermark-link" class="link-download hidden" download="watermarked_document.pdf">
                    <i class="fas fa-download"></i> Download Watermarked PDF
                </a>
            </div>
        </div>

        <div id="crop-pdf-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">Crop PDF</h2>
                    <button id="clear-crop-pdf-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Crop pages of your PDF document to a specified area.</p>

                <input type="file" id="crop-pdf-input" accept="application/pdf" class="hidden">
                <div id="crop-pdf-drop-area" class="pdf-drop-area text-gray-400">
                    <i class="fas fa-file-pdf text-primary-color text-4xl mb-2"></i>
                    <p class="text-lg font-semibold mb-1">Drag & Drop PDF Here</p>
                    <p class="mb-2">or</p>
                    <button type="button" onclick="document.getElementById('crop-pdf-input').click()" class="btn-primary px-6 py-2 text-base">
                        <i class="fas fa-upload"></i> Select PDF
                    </button>
                    <span id="selected-crop-pdf-name" class="selected-file-name mt-2">No file chosen</span>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-300 text-left text-sm font-semibold mb-1">Crop Area (mm from top-left corner):</label>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                        <div>
                            <label for="crop-x" class="block text-gray-400 text-sm mb-1">X:</label>
                            <input type="number" id="crop-x" value="0" min="0" class="form-input">
                        </div>
                        <div>
                            <label for="crop-y" class="block text-gray-400 text-sm mb-1">Y:</label>
                            <input type="number" id="crop-y" value="0" min="0" class="form-input">
                        </div>
                        <div>
                            <label for="crop-width" class="block text-gray-400 text-sm mb-1">Width:</label>
                            <input type="number" id="crop-width" value="210" min="1" class="form-input">
                        </div>
                        <div>
                            <label for="crop-height" class="block text-gray-400 text-sm mb-1">Height:</label>
                            <input type="number" id="crop-height" value="297" min="1" class="form-input">
                        </div>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row sm:space-x-4 mb-6">
                    <div class="flex-1 mb-4 sm:mb-0">
                        <label for="crop-page-start" class="block text-gray-300 text-left text-sm font-semibold mb-1">Start Page (optional):</label>
                        <input type="number" id="crop-page-start" min="1" placeholder="e.g., 1" class="form-input">
                    </div>
                    <div class="flex-1">
                        <label for="crop-page-end" class="block text-gray-300 text-left text-sm font-semibold mb-1">End Page (optional):</label>
                        <input type="number" id="crop-page-end" min="1" placeholder="e.g., 5" class="form-input">
                    </div>
                </div>

                <button id="crop-pdf-btn" class="btn-primary w-full" disabled>
                    <i class="fas fa-crop-alt"></i> Crop PDF
                </button>

                <div id="loading-message-crop-pdf" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Cropping PDF...</p>
                </div>
                <div id="status-message-crop-pdf" class="message-box hidden"></div>

                <a id="download-crop-pdf-link" class="link-download hidden" download="cropped_document.pdf">
                    <i class="fas fa-download"></i> Download Cropped PDF
                </a>
            </div>
        </div>

        <div id="add-text-to-pdf-section" class="tab-content hidden">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="section-title">Add Text to PDF</h2>
                    <button id="clear-add-text-pdf-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Add new text content to specific pages of your PDF.</p>

                <input type="file" id="add-text-pdf-input" accept="application/pdf" class="hidden">
                <div id="add-text-pdf-drop-area" class="pdf-drop-area text-gray-400">
                    <i class="fas fa-file-pdf text-primary-color text-4xl mb-2"></i>
                    <p class="text-lg font-semibold mb-1">Drag & Drop PDF Here</p>
                    <p class="mb-2">or</p>
                    <button type="button" onclick="document.getElementById('add-text-pdf-input').click()" class="btn-primary px-6 py-2 text-base">
                        <i class="fas fa-upload"></i> Select PDF
                    </button>
                    <span id="selected-add-text-pdf-name" class="selected-file-name mt-2">No file chosen</span>
                </div>

                <div class="mb-4">
                    <label for="text-to-add" class="block text-gray-300 text-left text-sm font-semibold mb-1">Text to Add:</label>
                    <textarea id="text-to-add" class="form-input form-textarea" rows="3" placeholder="Enter the text you want to add..."></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="add-text-page-number" class="block text-gray-300 text-left text-sm font-semibold mb-1">Page Number:</label>
                        <input type="number" id="add-text-page-number" class="form-input" value="1" min="1">
                    </div>
                    <div>
                        <label for="add-text-font-size" class="block text-gray-300 text-left text-sm font-semibold mb-1">Font Size (px):</label>
                        <input type="number" id="add-text-font-size" class="form-input" value="12" min="8" max="72">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="add-text-color" class="block text-gray-300 text-left text-sm font-semibold mb-1">Color:</label>
                        <input type="color" id="add-text-color" class="form-input h-10" value="#000000">
                    </div>
                    <div>
                        <label for="add-text-x" class="block text-gray-400 text-sm mb-1">X Position (mm):</label>
                        <input type="number" id="add-text-x" value="10" min="0" class="form-input">
                    </div>
                    <div>
                        <label for="add-text-y" class="block text-gray-400 text-sm mb-1">Y Position (mm):</label>
                        <input type="number" id="add-text-y" value="10" min="0" class="form-input">
                    </div>
                </div>

                <button id="add-text-to-pdf-btn" class="btn-primary w-full" disabled>
                    <i class="fas fa-font"></i> Add Text to PDF
                </button>

                <div id="loading-message-add-text-pdf" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Adding text...</p>
                </div>
                <div id="status-message-add-text-pdf" class="message-box hidden"></div>

                <a id="download-add-text-pdf-link" class="link-download hidden" download="text_added_document.pdf">
                    <i class="fas fa-download"></i> Download Modified PDF
                </a>
            </div>
        </div>


        <div id="resume-builder-section" class="tab-content resume-builder-section">
            <div class="card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="section-title">Resume Builder</h2>
                    <button id="clear-resume-btn" class="btn-clear hidden">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <p class="section-description">Create a professional resume by filling out your details and choosing a template.</p>

                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-3 text-gray-300">Choose a Template</h3>
                    <div class="flex flex-col sm:flex-row justify-center gap-4" id="template-selection">
                        <button class="template-card active flex-1" data-template="modern">Modern</button>
                        <button class="template-card flex-1" data-template="classic">Classic</button>
                        <button class="template-card flex-1" data-template="minimal">Minimal</button>
                    </div>
                </div>

                <div class="mb-8 p-4 border border-gray-700 rounded-md bg-gray-800">
                    <h3 class="text-xl font-semibold mb-3 text-gray-300">Customize Your Resume</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="font-select" class="block text-gray-400 font-medium mb-1 text-left">Font Family:</label>
                            <select id="font-select" class="form-input">
                                <option value="Inter">Inter</option>
                                <option value="Roboto">Roboto</option>
                                <option value="Open Sans">Open Sans</option>
                                <option value="Playfair Display">Playfair Display (Serif)</option>
                            </select>
                        </div>
                        <div>
                            <label for="primary-color" class="block text-gray-400 font-medium mb-1 text-left">Primary Color:</label>
                            <input type="color" id="primary-color" value="#6366f1" class="w-full h-10 rounded-md border-gray-700">
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="text-md font-semibold mb-2 text-gray-300 text-left">List Styles:</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="bullet-type" class="block text-gray-400 font-medium mb-1 text-left">Bullet Type:</label>
                                <select id="bullet-type" class="form-input">
                                    <option value="disc">Disc (Default)</option>
                                    <option value="circle">Circle</option>
                                    <option value="square">Square</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                            <div>
                                <label for="list-line-height" class="block text-gray-400 font-medium mb-1 text-left">List Line Spacing:</label>
                                <input type="range" id="list-line-height" min="1.0" max="2.0" step="0.1" value="1.5" class="w-full h-10">
                                <span id="list-line-height-value" class="text-gray-400 text-sm mt-1 block text-right">1.5x</span>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="text-md font-semibold mb-2 text-gray-300 text-left">Section Order (Drag & Drop):</h4>
                        <ul id="section-order-list" class="bg-gray-900 border border-gray-700 rounded-md p-3 text-left">
                            </ul>
                    </div>
                </div>

                <div class="text-left">
                    <h3 class="text-xl font-semibold mb-3 text-gray-300">Enter Your Details</h3>

                    <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                        <h4 class="text-lg font-semibold text-gray-300 mb-3">Personal Information</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="name-input" class="block text-gray-400 font-medium mb-1 text-left">Your Name:</label>
                                <input type="text" id="name-input" placeholder="Your Name" class="form-input">
                            </div>
                            <div>
                                <label for="title-input" class="block text-gray-400 font-medium mb-1 text-left">Professional Title:</label>
                                <input type="text" id="title-input" placeholder="Professional Title" class="form-input">
                            </div>
                            <div>
                                <label for="email-input" class="block text-gray-400 font-medium mb-1 text-left">Email:</label>
                                <input type="email" id="email-input" placeholder="Email" class="form-input">
                            </div>
                            <div>
                                <label for="phone-input" class="block text-gray-400 font-medium mb-1 text-left">Phone:</label>
                                <input type="tel" id="phone-input" placeholder="Phone" class="form-input">
                            </div>
                            <div>
                                <label for="linkedin-input" class="block text-gray-400 font-medium mb-1 text-left">LinkedIn Profile URL:</label>
                                <input type="text" id="linkedin-input" placeholder="LinkedIn Profile URL" class="form-input">
                            </div>
                            <div>
                                <label for="website-input" class="block text-gray-400 font-medium mb-1 text-left">Personal Website URL:</label>
                                <input type="text" id="website-input" placeholder="Personal Website URL" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                        <h4 class="text-lg font-semibold text-gray-300 mb-3">Summary / About Me</h4>
                        <label for="summary-input" class="block text-gray-400 font-medium mb-1 text-left">Brief Summary:</label>
                        <textarea id="summary-input" rows="4" placeholder="A brief summary of your skills and experience..." class="form-input"></textarea>
                    </div>

                    <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                        <h4 class="text-lg font-semibold text-gray-300 mb-3 flex justify-between items-center">
                            Work Experience
                            <button id="add-experience-btn" class="btn-add-dynamic">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </h4>
                        <div id="experience-entries" class="space-y-4">
                            </div>
                    </div>

                    <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                        <h4 class="text-lg font-semibold text-gray-300 mb-3 flex justify-between items-center">
                            Education
                            <button id="add-education-btn" class="btn-add-dynamic">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </h4>
                        <div id="education-entries" class="space-y-4">
                            </div>
                    </div>

                    <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                        <h4 class="text-lg font-semibold text-gray-300 mb-3">Skills (Comma-separated)</h4>
                        <label for="skills-input" class="block text-gray-400 font-medium mb-1 text-left">List your skills, separated by commas:</label>
                        <textarea id="skills-input" rows="2" placeholder="e.g., JavaScript, React, Data Analysis, Project Management" class="form-input"></textarea>
                    </div>

                    <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                        <h4 class="text-lg font-semibold text-gray-300 mb-3 flex justify-between items-center">
                            Projects
                            <button id="add-project-btn" class="btn-add-dynamic">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </h4>
                        <div id="project-entries" class="space-y-4">
                            </div>
                    </div>

                    <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                        <h4 class="text-lg font-semibold text-gray-300 mb-3 flex justify-between items-center">
                            Awards & Certifications
                            <button id="add-award-btn" class="btn-add-dynamic">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </h4>
                        <div id="award-entries" class="space-y-4">
                            </div>
                    </div>

                </div>

                <div class="mb-8 p-4 border border-gray-700 rounded-md bg-gray-800">
                    <h3 class="text-xl font-semibold mb-4 text-gray-200 text-left">Add New Project</h3>
                    <button id="toggle-project-form-btn" class="btn-primary">
                        <i class="fas fa-plus-circle"></i> Add Project Details
                    </button>

                    <div id="project-input-form" class="collapsible-content">
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold mb-3 text-gray-300">Enter Project Details:</h4>
                            <div class="mb-3">
                                <label for="project-title" class="block text-gray-400 font-medium mb-1 text-left">Project Title:</label>
                                <input type="text" id="project-title" class="form-input" placeholder="e.g., Evexa Universal Converter">
                            </div>
                            <div class="mb-3">
                                <label for="project-date" class="block text-gray-400 font-medium mb-1 text-left">Date (e.g., Jan 2023 - Present):</label>
                                <input type="text" id="project-date" class="form-input" placeholder="e.g., Jan 2023 - Present">
                            </div>
                            <div class="mb-3">
                                <label for="project-description" class="block text-gray-400 font-medium mb-1 text-left">Description:</label>
                                <textarea id="project-description" class="form-input" rows="4" placeholder="Briefly describe your role, responsibilities, and achievements. Use bullet points for impact."></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="project-link" class="block text-gray-400 font-medium mb-1 text-left">Project Link (Optional):</label>
                                <input type="url" id="project-link" class="form-input" placeholder="e.g., https://yourproject.com">
                            </div>
                            <button id="save-project-btn" class="btn-primary mr-2">
                                <i class="fas fa-save"></i> Save Project
                            </button>
                            <button id="cancel-project-btn" class="btn-clear">
                                <i class="fas fa-times-circle"></i> Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-3 text-gray-300">Live Preview</h3>
                    <div id="resume-preview-container" class="bg-gray-900 border border-gray-700 rounded-md shadow-lg" style="min-height: 400px; max-height: 800px;">
                        <div id="resume-preview" class="resume-template modern">
                            </div>
                    </div>
                </div>

                <button id="generate-resume-pdf-btn" class="btn-primary w-full mt-8">
                    <i class="fas fa-file-alt"></i> Generate Resume PDF
                </button>
                <a id="download-resume-pdf-link" class="link-download hidden" download="my_resume.pdf">
                    <i class="fas fa-download"></i> Download Resume PDF
                </a>
                <div id="loading-message-resume-pdf" class="message-box info hidden mt-4">
                    <p><i class="fas fa-spinner fa-spin"></i> Generating PDF...</p>
                </div>
                <div id="status-message-resume-pdf" class="message-box hidden"></div>
            </div>
        </div>

        <div id="note-taker-section" class="tab-content hidden">
            <div class="card">
                <h2 class="section-title">Simple Note Taker</h2>
                <p class="section-description">Jot down quick notes or lecture summaries. Your notes are saved automatically.</p>
                <div class="converter-content">
                    <textarea id="noteInput" class="note-input form-input" placeholder="Type your notes here..."></textarea>
                    <button class="save-note-button btn-primary"><i class="fas fa-save"></i> Save Note</button>
                </div>
                <div class="saved-notes-container" id="savedNotesContainer">
                    <h3>Your Saved Notes</h3>
                    <ul class="notes-list" id="notesList">
                        </ul>
                    <p class="no-notes-message">No notes saved yet.</p>
                </div>
            </div>
        </div>

        <div id="motivational-journal-section" class="tab-content hidden">
            <div class="card">
                <h2 class="section-title">Motivational Quotes Wall & Journal</h2>
                <p class="section-description">Start your day with inspiration and jot down your thoughts.</p>

                <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800 text-center">
                    <h3 class="text-xl font-semibold text-gray-300 mb-3">Today's Inspiration</h3>
                    <p id="motivational-quote" class="text-2xl font-bold text-primary-color italic mb-4">
                        "The only way to do great work is to love what you do."
                    </p>
                    <p id="quote-author" class="text-gray-400">- Author Name</p>
                </div>

                <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                    <h3 class="text-xl font-semibold text-gray-300 mb-3">Daily Journal <span id="journal-date" class="text-gray-400 text-base font-normal ml-2"></span></h3>
                    <textarea id="daily-journal-input" class="form-input form-textarea" rows="8" placeholder="Write your thoughts, plans, or reflections for today..."></textarea>
                    <p class="text-gray-400 text-sm mt-2">Your journal entries are auto-saved in your browser.</p>
                </div>

                <div class="mb-6 p-4 border border-gray-700 rounded-md bg-gray-800">
                    <h3 class="text-xl font-semibold text-gray-300 mb-3">Past Journal Entries</h3>
                    <div id="past-journal-entries" class="space-y-4">
                        <p class="text-gray-400 italic text-center" id="no-past-entries-message">No past entries yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="app-footer">
        <p>&copy; 2025 Evexa Universal Converter. All rights reserved.</p>
        <p>Powered by jsPDF, html2canvas, Sortable.js, PDF.js, and JSZip</p>
    </footer>

    <script type="module">
        // Import jsPDF (requires type="module" for UMD build)
        const { jsPDF } = window.jspdf;

        // --- Global Utility Functions ---
        /**
         * Prevents default behavior and stops event propagation.
         * @param {Event} e - The event object.
         */
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Helper to convert PDF.js viewport pixels (assuming 72 DPI for PDF points) to mm for jsPDF
        const ptToMm = (pt) => pt * 25.4 / 72;

        // --- Global Tab Switching Logic ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const convertPdfMainButton = document.querySelector('.tab-button[data-tab="pdf-tools-group"]');
        const dropdownContent = document.querySelector('.dropdown .dropdown-content');
        const searchBar = document.getElementById('search-bar');
        const searchResultsDropdown = document.getElementById('search-results-dropdown');

        // Define all available tabs with their IDs and labels
        const allTabsData = [
            { id: 'image-to-pdf-section', label: 'Image to PDF', group: 'pdf-tools-group' },
            { id: 'pdf-to-image-section', label: 'PDF to Image', group: 'pdf-tools-group' },
            { id: 'text-to-pdf-section', label: 'Text to PDF', group: 'pdf-tools-group' },
            { id: 'rotate-pdf-section', label: 'Rotate PDF', group: 'pdf-tools-group' },
            { id: 'add-page-numbers-section', label: 'Add Page Numbers', group: 'pdf-tools-group' },
            { id: 'add-watermark-section', label: 'Add Watermark', group: 'pdf-tools-group' },
            { id: 'crop-pdf-section', label: 'Crop PDF', group: 'pdf-tools-group' },
            { id: 'add-text-to-pdf-section', label: 'Add Text to PDF', group: 'pdf-tools-group' },
            { id: 'resume-builder-section', label: 'Resume Builder', group: null },
            { id: 'note-taker-section', label: 'Note Taker', group: null },
            { id: 'motivational-journal-section', label: 'Motivational Journal', group: null }
        ];

        /**
         * Switches the active tab and manages visibility of content sections.
         * @param {string} activeTabId - The ID of the tab content to show.
         */
        function switchTab(activeTabId) {
            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });

            // Show the active tab content
            const targetContent = document.getElementById(activeTabId);
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }

            // Deactivate all main tab buttons and sub-tab buttons
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Activate the clicked button
            const clickedButton = document.querySelector(`.tab-button[data-tab="${activeTabId}"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }

            // If a sub-tab (Image to PDF, PDF to Image, Text to PDF) is activated,
            // also ensure the main "All PDF Solutions" button is active.
            if (allTabsData.find(tab => tab.id === activeTabId && tab.group === 'pdf-tools-group')) {
                if (convertPdfMainButton) {
                    convertPdfMainButton.classList.add('active');
                }
            } else {
                // If switching to a non-PDF tool, ensure PDF main button is not active
                if (convertPdfMainButton) {
                    convertPdfMainButton.classList.remove('active');
                }
            }


            // Ensure the dropdown is closed when switching to any tab (main or sub-tab)
            if (dropdownContent) {
                dropdownContent.classList.remove('show-dropdown'); // Hide dropdown using the class
            }

            // Specific initialization for Motivational Journal when its tab is active
            if (activeTabId === 'motivational-journal-section') {
                displayRandomQuote();
                renderJournal();
            }
        }

        // Event listeners for all tab buttons (main and sub-tabs)
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.dataset.tab === 'pdf-tools-group') {
                    // For the main "All PDF Solutions" button, toggle the 'show-dropdown' class
                    if (dropdownContent) {
                        dropdownContent.classList.toggle('show-dropdown');
                    }
                } else {
                    // For all other main tabs and sub-tabs, switch content
                    switchTab(button.dataset.tab);
                    // When a sub-tab is clicked, ensure the dropdown closes (handled by switchTab)
                }
                // Clear search and reset nav state after a tab is clicked
                searchBar.value = '';
                filterNavButtons(''); // Pass empty query to reset
                searchResultsDropdown.classList.remove('show');
            });
        });

        // Close the dropdown if the user clicks outside of it
        window.addEventListener('click', function(event) {
            // Check if the click was NOT on the main dropdown button AND NOT inside the dropdown content
            if (convertPdfMainButton && dropdownContent) {
                const isClickInsideDropdownButton = convertPdfMainButton.contains(event.target);
                const isClickInsideDropdownContent = dropdownContent.contains(event.target);

                if (!isClickInsideDropdownButton && !isClickInsideDropdownContent) {
                    dropdownContent.classList.remove('show-dropdown');
                }
            }
            // Also close search results dropdown if clicked outside
            if (searchBar && searchResultsDropdown && !searchBar.contains(event.target) && !searchResultsDropdown.contains(event.target)) {
                searchResultsDropdown.classList.remove('show');
            }
        });

        // --- Search Functionality ---
        if (searchBar) {
            searchBar.addEventListener('input', () => {
                const query = searchBar.value.toLowerCase().trim();
                filterNavButtons(query);
                displaySearchResults(query);
            });

            // Show search results dropdown on focus if there's a query
            searchBar.addEventListener('focus', () => {
                const query = searchBar.value.toLowerCase().trim();
                if (query !== '') {
                    displaySearchResults(query);
                }
            });
        }

        function filterNavButtons(query) {
            const allNavButtons = document.querySelectorAll('.tab-nav .tab-button');
            const subTabButtons = document.querySelectorAll('.dropdown-content .tab-button');

            // Hide all buttons initially for filtering
            allNavButtons.forEach(button => {
                button.style.display = 'none';
            });

            if (query === '') {
                // If search bar is empty, show all original buttons
                allNavButtons.forEach(button => {
                    button.style.display = 'flex';
                });
                // Ensure dropdown hover functionality is re-enabled
                if (convertPdfMainButton) {
                    convertPdfMainButton.parentElement.classList.remove('search-active');
                }
            } else {
                // Add a class to parent dropdown to disable hover during search
                if (convertPdfMainButton) {
                    convertPdfMainButton.parentElement.classList.add('search-active');
                }

                let pdfToolsGroupMatched = false;

                // Filter sub-tab buttons first
                subTabButtons.forEach(subButton => {
                    const buttonText = subButton.dataset.label.toLowerCase(); // Use data-label for filtering
                    if (buttonText.includes(query)) {
                        subButton.style.display = 'flex';
                        pdfToolsGroupMatched = true; // A sub-item matched, so show the main PDF button
                    } else {
                        subButton.style.display = 'none';
                    }
                });

                // Filter main tab buttons
                document.querySelectorAll('.tab-nav > .tab-button').forEach(mainButton => {
                    const buttonText = mainButton.dataset.label.toLowerCase(); // Use data-label for filtering
                    if (mainButton.dataset.tab === 'pdf-tools-group') {
                        if (pdfToolsGroupMatched || buttonText.includes(query)) {
                            mainButton.style.display = 'flex';
                            // When search is active, force dropdown to show if its items match
                            if (dropdownContent) dropdownContent.classList.add('show-dropdown');
                        } else {
                            mainButton.style.display = 'none';
                        }
                    } else {
                        if (buttonText.includes(query)) {
                            mainButton.style.display = 'flex';
                        } else {
                            mainButton.style.display = 'none';
                        }
                    }
                });
            }
        }

        function displaySearchResults(query) {
            searchResultsDropdown.innerHTML = ''; // Clear previous results

            if (query === '') {
                searchResultsDropdown.classList.remove('show');
                return;
            }

            const filteredResults = allTabsData.filter(tab =>
                tab.label.toLowerCase().includes(query)
            );

            if (filteredResults.length > 0) {
                filteredResults.forEach(tab => {
                    const resultItem = document.createElement('div');
                    resultItem.classList.add('search-result-item');
                    resultItem.textContent = tab.label;
                    resultItem.dataset.tab = tab.id; // Store original tab ID

                    resultItem.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent click from propagating to window and closing immediately
                        switchTab(tab.id); // Switch to the selected tab
                        searchBar.value = ''; // Clear search bar
                        filterNavButtons(''); // Reset navigation buttons to default state
                        searchResultsDropdown.classList.remove('show'); // Hide search results
                    });
                    searchResultsDropdown.appendChild(resultItem);
                });
                searchResultsDropdown.classList.add('show');
            } else {
                searchResultsDropdown.classList.remove('show');
            }
        }


        // --- Image to PDF Converter Logic ---
        const imageInput = document.getElementById('image-input');
        const dropArea = document.getElementById('drop-area');
        const imagePreviewsContainer = document.getElementById('image-previews-container');
        const imagePreviews = document.getElementById('image-previews');
        const convertBtnImgPdf = document.getElementById('convert-btn-img-pdf');
        const downloadLinkImgPdf = document.getElementById('download-link-img-pdf');
        const loadingMessageImgPdf = document.getElementById('loading-message-img-pdf');
        const statusMessageImgPdf = document.getElementById('status-message-img-pdf');
        const clearImgPdfBtn = document.getElementById('clear-img-pdf-btn');

        const pdfPageSizeSelect = document.getElementById('pdf-page-size');
        const pdfOrientationSelect = document.getElementById('pdf-orientation');
        const marginInputs = {
            top: document.getElementById('margin-top'),
            right: document.getElementById('margin-right'),
            bottom: document.getElementById('margin-bottom'),
            left: document.getElementById('margin-left')
        };

        let selectedImageFiles = []; // Stores File objects with dataURL, maintaining order

        // Drag and Drop Handlers
        if (dropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => dropArea.classList.add('highlight'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => dropArea.classList.remove('highlight'), false);
            });

            dropArea.addEventListener('drop', handleDrop, false);
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleImageFiles(files);
        }

        // File Input Handler
        if (imageInput) {
            imageInput.addEventListener('change', (e) => {
                handleImageFiles(e.target.files);
            });
        }

        function handleImageFiles(files) {
            if (loadingMessageImgPdf) loadingMessageImgPdf.classList.remove('hidden');
            if (statusMessageImgPdf) statusMessageImgPdf.classList.add('hidden');
            if (downloadLinkImgPdf) downloadLinkImgPdf.classList.add('hidden');
            if (clearImgPdfBtn) clearImgPdfBtn.classList.add('hidden');

            const newFiles = Array.from(files).filter(file => file.type.startsWith('image/'));

            if (newFiles.length === 0 && selectedImageFiles.length === 0) {
                showMessageImgPdf('error', 'Please upload image files (JPG, PNG, WebP, GIF, BMP).', true);
                if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
                return;
            }

            let loadedCount = 0;
            const totalToLoad = newFiles.length;

            if (totalToLoad === 0 && selectedImageFiles.length > 0) {
                 if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
                 return;
            } else if (totalToLoad === 0 && selectedImageFiles.length === 0) {
                if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
                showMessageImgPdf('error', 'No valid image files were selected.', true);
                return;
            }

            newFiles.forEach(file => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onloadend = () => {
                    const img = new Image();
                    img.src = reader.result;
                    img.onload = () => {
                        selectedImageFiles.push({ file: file, dataURL: reader.result, width: img.width, height: img.height });
                        loadedCount++;
                        if (loadedCount === totalToLoad) {
                            renderImagePreviews();
                            if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
                            updateConvertButtonStateImgPdf();
                            showMessageImgPdf('success', `${newFiles.length} image(s) added successfully.`, true);
                        }
                    };
                    img.onerror = () => {
                        showMessageImgPdf('error', `Failed to load image: ${file.name}. It might be corrupted or an unsupported format.`, true);
                        loadedCount++;
                        if (loadedCount === totalToLoad) {
                            if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
                            updateConvertButtonStateImgPdf();
                        }
                    }
                };
                reader.onerror = () => {
                    showMessageImgPdf('error', `Failed to read file: ${file.name}.`, true);
                    loadedCount++;
                    if (loadedCount === totalToLoad) {
                        if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
                        updateConvertButtonStateImgPdf();
                    }
                };
            });
        }

        function renderImagePreviews() {
            if (!imagePreviews) return;
            imagePreviews.innerHTML = '';
            if (selectedImageFiles.length > 0) {
                if (imagePreviewsContainer) imagePreviewsContainer.classList.remove('hidden');
            } else {
                if (imagePreviewsContainer) imagePreviewsContainer.classList.add('hidden');
            }

            selectedImageFiles.forEach((imgData, index) => {
                const previewItem = document.createElement('div');
                previewItem.classList.add('image-preview-item');
                previewItem.setAttribute('data-index', index);

                const img = document.createElement('img');
                img.src = imgData.dataURL;
                img.alt = `Preview of ${imgData.file.name}`;
                previewItem.appendChild(img);

                const deleteBtn = document.createElement('button');
                deleteBtn.classList.add('delete-btn');
                deleteBtn.innerHTML = '&times;';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    removeImage(imgData.file.name);
                };
                previewItem.appendChild(deleteBtn);

                imagePreviews.appendChild(previewItem);
            });
        }

        function removeImage(fileName) {
            const initialCount = selectedImageFiles.length;
            selectedImageFiles = selectedImageFiles.filter(imgData => imgData.file.name !== fileName);
            if (selectedImageFiles.length < initialCount) {
                renderImagePreviews();
                updateConvertButtonStateImgPdf();
                showMessageImgPdf('info', `${fileName} removed.`, true);
            }
        }

        function updateConvertButtonStateImgPdf() {
            if (convertBtnImgPdf) {
                if (selectedImageFiles.length > 0) {
                    convertBtnImgPdf.disabled = false;
                    convertBtnImgPdf.classList.remove('hidden');
                    if (clearImgPdfBtn) clearImgPdfBtn.classList.remove('hidden'); // Show clear button when images are present
                } else {
                    convertBtnImgPdf.disabled = true;
                    convertBtnImgPdf.classList.add('hidden');
                    if (clearImgPdfBtn) clearImgPdfBtn.classList.add('hidden'); // Hide clear button when no images
                }
            }
        }

        function showMessageImgPdf(type, message, autoHide = false) {
            if (!statusMessageImgPdf) return;
            statusMessageImgPdf.classList.remove('hidden', 'info', 'success', 'error');
            statusMessageImgPdf.classList.add(type);
            statusMessageImgPdf.innerHTML = message; // Use innerHTML to allow icons

            if (autoHide) {
                setTimeout(() => {
                    statusMessageImgPdf.classList.add('hidden');
                }, 5000);
            }
        }

        // Sortable.js for Drag & Drop Reordering (Image to PDF)
        if (imagePreviews) {
            new Sortable(imagePreviews, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: function (evt) {
                    const oldIndex = evt.oldIndex;
                    const newIndex = evt.newIndex;
                    const [movedItem] = selectedImageFiles.splice(oldIndex, 1);
                    selectedImageFiles.splice(newIndex, 0, movedItem);
                },
            });
        }

        // Clear Image to PDF Section
        if (clearImgPdfBtn) {
            clearImgPdfBtn.addEventListener('click', clearImageToPdfSection);
        }

        function clearImageToPdfSection() {
            selectedImageFiles = [];
            if (imageInput) imageInput.value = '';
            renderImagePreviews();
            updateConvertButtonStateImgPdf();
            if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
            if (statusMessageImgPdf) statusMessageImgPdf.classList.add('hidden');
            if (downloadLinkImgPdf) downloadLinkImgPdf.classList.add('hidden');
            if (clearImgPdfBtn) clearImgPdfBtn.classList.add('hidden');
            if (pdfPageSizeSelect) pdfPageSizeSelect.value = 'a4';
            if (pdfOrientationSelect) pdfOrientationSelect.value = 'p';
            if (marginInputs.top) marginInputs.top.value = '10';
            if (marginInputs.right) marginInputs.right.value = '10';
            if (marginInputs.bottom) marginInputs.bottom.value = '10';
            if (marginInputs.left) marginInputs.left.value = '10';
            showMessageImgPdf('info', '<i class="fas fa-info-circle"></i> Image to PDF section cleared.', true);
        }

        // PDF Conversion Logic (Image to PDF)
        if (convertBtnImgPdf) {
            convertBtnImgPdf.addEventListener('click', convertImagesToPdf);
        }
        async function convertImagesToPdf() {
            if (selectedImageFiles.length === 0) {
                showMessageImgPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please upload images first!', true);
                return;
            }

            if (convertBtnImgPdf) {
                convertBtnImgPdf.disabled = true;
                convertBtnImgPdf.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
            }
            if (loadingMessageImgPdf) loadingMessageImgPdf.classList.remove('hidden');
            showMessageImgPdf('info', '<i class="fas fa-info-circle"></i> Converting images to PDF...', false);
            if (downloadLinkImgPdf) downloadLinkImgPdf.classList.add('hidden');
            if (clearImgPdfBtn) clearImgPdfBtn.classList.add('hidden');

            try {
                const pageSize = pdfPageSizeSelect ? pdfPageSizeSelect.value : 'a4';
                const orientation = pdfOrientationSelect ? pdfOrientationSelect.value : 'p';
                const marginTop = parseFloat(marginInputs.top ? marginInputs.top.value : '0') || 0;
                const marginRight = parseFloat(marginInputs.right ? marginInputs.right.value : '0') || 0;
                const marginBottom = parseFloat(marginInputs.bottom ? marginInputs.bottom.value : '0') || 0;
                const marginLeft = parseFloat(marginInputs.left ? marginInputs.left.value : '0') || 0;

                const doc = new jsPDF(orientation, 'mm', pageSize);

                let pageActualWidth = doc.internal.pageSize.getWidth();
                let pageActualHeight = doc.internal.pageSize.getHeight();

                const availableWidth = pageActualWidth - marginLeft - marginRight;
                const availableHeight = pageActualHeight - marginTop - marginBottom;

                for (let i = 0; i < selectedImageFiles.length; i++) {
                    const imgData = selectedImageFiles[i].dataURL;
                    const imgWidth = selectedImageFiles[i].width;
                    const imgHeight = selectedImageFiles[i].height;

                    if (!imgData || imgData.length < 50) { // Basic check for empty/invalid data URL
                        console.error(`Invalid image data for image ${selectedImageFiles[i].file.name}. Skipping this image.`);
                        showMessageImgPdf('error', `<i class="fas fa-exclamation-triangle"></i> Failed to process image: ${selectedImageFiles[i].file.name}.`, true);
                        continue; // Skip to next image
                    }

                    const aspectRatio = imgWidth / imgHeight;
                    let imgPdfWidth = availableWidth;
                    let imgPdfHeight = availableWidth / aspectRatio;

                    if (imgPdfHeight > availableHeight) {
                        imgPdfHeight = availableHeight;
                        imgPdfWidth = availableHeight * aspectRatio;
                    }

                    if (i > 0) {
                        doc.addPage(pageSize, orientation);
                    }

                    const xPos = marginLeft + (availableWidth - imgPdfWidth) / 2;
                    const yPos = marginTop + (availableHeight - imgPdfHeight) / 2;

                    const imgTypeMatch = imgData.match(/^data:image\/([a-zA-Z0-9]+);base64,/);
                    const imgType = imgTypeMatch ? imgTypeMatch[1].toUpperCase() : 'JPEG';

                    doc.addImage(imgData, imgType, xPos, yPos, imgPdfWidth, imgPdfHeight);
                }

                const pdfBlob = doc.output('blob');
                const pdfUrl = URL.createObjectURL(pdfBlob);

                if (downloadLinkImgPdf) {
                    downloadLinkImgPdf.href = pdfUrl;
                    downloadLinkImgPdf.classList.remove('hidden');
                }
                if (clearImgPdfBtn) clearImgPdfBtn.classList.remove('hidden');
                showMessageImgPdf('success', '<i class="fas fa-check-circle"></i> PDF created successfully! Click "Download PDF".', false);

            } catch (error) {
                console.error("Error during PDF conversion:", error);
                showMessageImgPdf('error', `<i class="fas fa-times-circle"></i> Error converting to PDF: ${error.message}. Please try again.`, false);
            } finally {
                if (convertBtnImgPdf) {
                    convertBtnImgPdf.disabled = false;
                    convertBtnImgPdf.innerHTML = '<i class="fas fa-file-pdf"></i> Convert to PDF';
                }
                if (loadingMessageImgPdf) loadingMessageImgPdf.classList.add('hidden');
            }
        }

        // --- PDF to Image Converter Logic (Requires PDF.js) ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const pdfInput = document.getElementById('pdf-input');
        const pdfDropArea = document.getElementById('pdf-drop-area');
        const selectedPdfName = document.getElementById('selected-pdf-name');
        const convertPdfToImgBtn = document.getElementById('convert-pdf-to-img-btn');
        const outputFormatSelect = document.getElementById('output-format');
        const resolutionScaleSelect = document.getElementById('resolution-scale');
        const pageStartInput = document.getElementById('page-start');
        const pageEndInput = document.getElementById('page-end');
        const pdfImageOutput = document.getElementById('pdf-image-output');
        const downloadAllImagesBtn = document.getElementById('download-all-images-btn');
        const loadingMessagePdfImg = document.getElementById('loading-message-pdf-img');
        const statusMessagePdfImg = document.getElementById('status-message-pdf-img'); // Corrected line
        const clearPdfImgBtn = document.getElementById('clear-pdf-img-btn');

        let convertedImageBlobs = [];

        if (pdfDropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                pdfDropArea.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                pdfDropArea.addEventListener(eventName, () => pdfDropArea.classList.add('highlight'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                pdfDropArea.addEventListener(eventName, () => pdfDropArea.classList.remove('highlight'), false);
            });

            pdfDropArea.addEventListener('drop', handlePdfDrop, false);
        }

        function handlePdfDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                if (pdfInput) pdfInput.files = files;
                handlePdfFileSelection();
            } else {
                showMessagePdfImg('error', '<i class="fas fa-exclamation-triangle"></i> Please drop a PDF file.', true);
            }
        }

        if (pdfInput) {
            pdfInput.addEventListener('change', handlePdfFileSelection);
        }

        function handlePdfFileSelection() {
            const file = pdfInput ? pdfInput.files[0] : null;
            if (file) {
                if (selectedPdfName) selectedPdfName.textContent = file.name;
                updateConvertPdfToImgButtonState();
                if (pdfImageOutput) pdfImageOutput.classList.add('hidden');
                if (downloadAllImagesBtn) downloadAllImagesBtn.classList.add('hidden');
                if (statusMessagePdfImg) statusMessagePdfImg.classList.add('hidden');
                if (clearPdfImgBtn) clearPdfImgBtn.classList.add('hidden');
            } else {
                if (selectedPdfName) selectedPdfName.textContent = 'No file chosen';
                updateConvertPdfToImgButtonState();
            }
        }

        function updateConvertPdfToImgButtonState() {
            if (convertPdfToImgBtn) {
                convertPdfToImgBtn.disabled = !pdfInput || !pdfInput.files || pdfInput.files.length === 0;
                if (!convertPdfToImgBtn.disabled) {
                    if (clearPdfImgBtn) clearPdfImgBtn.classList.remove('hidden'); // Show clear button when PDF is selected
                } else {
                    if (clearPdfImgBtn) clearPdfImgBtn.classList.add('hidden'); // Hide clear button when no PDF
                }
            }
        }

        function showMessagePdfImg(type, message, autoHide = false) {
            if (!statusMessagePdfImg) return;
            statusMessagePdfImg.classList.remove('hidden', 'info', 'success', 'error');
            statusMessagePdfImg.classList.add(type);
            statusMessagePdfImg.innerHTML = message;

            if (autoHide) {
                setTimeout(() => {
                    statusMessagePdfImg.classList.add('hidden');
                }, 5000);
            }
        }

        if (convertPdfToImgBtn) {
            convertPdfToImgBtn.addEventListener('click', async () => {
                const file = pdfInput ? pdfInput.files[0] : null;
                if (!file) {
                    showMessagePdfImg('error', '<i class="fas fa-exclamation-triangle"></i> Please select a PDF file.', true);
                    return;
                }

                if (convertPdfToImgBtn) {
                    convertPdfToImgBtn.disabled = true;
                    convertPdfToImgBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
                }
                if (loadingMessagePdfImg) loadingMessagePdfImg.classList.remove('hidden');
                showMessagePdfImg('info', '<i class="fas fa-info-circle"></i> Converting PDF to images...', false);
                if (pdfImageOutput) pdfImageOutput.innerHTML = '';
                if (pdfImageOutput) pdfImageOutput.classList.add('hidden');
                if (downloadAllImagesBtn) downloadAllImagesBtn.classList.add('hidden');
                if (clearPdfImgBtn) clearPdfImgBtn.classList.add('hidden');
                convertedImageBlobs = [];

                try {
                    const pdf = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;

                    const outputFormat = outputFormatSelect ? outputFormatSelect.value : 'jpeg';
                    const resolutionScale = resolutionScaleSelect ? parseFloat(resolutionScaleSelect.value) : 1.5;
                    const startPage = pageStartInput ? parseInt(pageStartInput.value) || 1 : 1;
                    const endPage = pageEndInput ? parseInt(pageEndInput.value) || pdf.numPages : pdf.numPages;

                    if (startPage > endPage || startPage < 1 || endPage > pdf.numPages) {
                        showMessagePdfImg('error', `<i class="fas fa-exclamation-triangle"></i> Invalid page range. PDF has ${pdf.numPages} pages.`, true);
                        return;
                    }

                    for (let i = startPage; i <= endPage; i++) {
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: resolutionScale });
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        await page.render({ canvasContext: context, viewport: viewport }).promise;

                        const dataUrl = canvas.toDataURL(`image/${outputFormat}`);
                        // Validate dataUrl before proceeding
                        if (!dataUrl || dataUrl.length < 50) {
                            console.error(`Invalid image data generated for PDF page ${i}. Skipping this page.`);
                            showMessagePdfImg('error', `<i class="fas fa-exclamation-triangle"></i> Failed to generate image for page ${i}.`, true);
                            continue; // Skip to next page
                        }

                        const blob = await new Promise(resolve => canvas.toBlob(resolve, `image/${outputFormat}`));
                        convertedImageBlobs.push({ blob: blob, name: `page_${i}.${outputFormat}` });

                        const imgWrapper = document.createElement('div');
                        imgWrapper.classList.add('p-2', 'bg-gray-800', 'rounded-md', 'shadow', 'text-center');
                        const img = document.createElement('img');
                        img.src = dataUrl;
                        img.alt = `Page ${i}`;
                        img.classList.add('max-w-full', 'h-auto', 'rounded-md');
                        const pageLabel = document.createElement('p');
                        pageLabel.classList.add('mt-2', 'text-gray-400', 'text-sm');
                        pageLabel.textContent = `Page ${i}`;

                        imgWrapper.appendChild(img);
                        imgWrapper.appendChild(pageLabel);
                        if (pdfImageOutput) pdfImageOutput.appendChild(imgWrapper);
                    }

                    if (pdfImageOutput) pdfImageOutput.classList.remove('hidden');
                    if (downloadAllImagesBtn) downloadAllImagesBtn.classList.remove('hidden');
                    if (clearPdfImgBtn) clearPdfImgBtn.classList.remove('hidden');
                    showMessagePdfImg('success', `<i class="fas fa-check-circle"></i> Converted ${convertedImageBlobs.length} page(s) to images.`, false);

                } catch (error) {
                    console.error("Error during PDF to Image conversion:", error);
                    showMessagePdfImg('error', `<i class="fas fa-times-circle"></i> Error converting PDF to image: ${error.message}. Please try again.`, false);
                } finally {
                    if (convertPdfToImgBtn) {
                        convertPdfToImgBtn.disabled = false;
                        convertPdfToImgBtn.innerHTML = '<i class="fas fa-images"></i> Convert PDF to Images';
                    }
                    if (loadingMessagePdfImg) loadingMessagePdfImg.classList.add('hidden');
                }
            });
        }

        // Download all images as ZIP
        if (downloadAllImagesBtn) {
            downloadAllImagesBtn.addEventListener('click', async () => {
                if (convertedImageBlobs.length === 0) {
                    showMessagePdfImg('error', '<i class="fas fa-exclamation-triangle"></i> No images to download. Please convert a PDF first.', true);
                    return;
                }

                showMessagePdfImg('info', '<i class="fas fa-info-circle"></i> Preparing ZIP download...', false);
                if (downloadAllImagesBtn) {
                    downloadAllImagesBtn.disabled = true;
                    downloadAllImagesBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Preparing ZIP...';
                }

                try {
                    const zip = new JSZip();
                    convertedImageBlobs.forEach(item => {
                        zip.file(item.name, item.blob);
                    });

                    const zipBlob = await zip.generateAsync({ type: "blob" });
                    const zipUrl = URL.createObjectURL(zipBlob);

                    const a = document.createElement('a');
                    a.href = zipUrl;
                    a.download = 'pdf_pages.zip';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(zipUrl);

                    showMessagePdfImg('success', '<i class="fas fa-check-circle"></i> Images downloaded as ZIP successfully!', false);
                } catch (error) {
                    console.error("Error generating ZIP:", error);
                    showMessagePdfImg('error', `<i class="fas fa-times-circle"></i> Failed to create ZIP file: ${error.message}.`, false);
                } finally {
                    if (downloadAllImagesBtn) {
                        downloadAllImagesBtn.disabled = false;
                        downloadAllImagesBtn.innerHTML = '<i class="fas fa-file-archive"></i> Download All Images as ZIP';
                    }
                }
            });
        }

        // Clear PDF to Image Section
        if (clearPdfImgBtn) {
            clearPdfImgBtn.addEventListener('click', clearPdfToImageSection);
        }
        function clearPdfToImageSection() {
            if (pdfInput) pdfInput.value = '';
            if (selectedPdfName) selectedPdfName.textContent = 'No file chosen';
            if (pdfImageOutput) pdfImageOutput.innerHTML = '';
            if (pdfImageOutput) pdfImageOutput.classList.add('hidden');
            if (downloadAllImagesBtn) downloadAllImagesBtn.classList.add('hidden');
            if (clearPdfImgBtn) clearPdfImgBtn.classList.add('hidden');
            convertedImageBlobs = [];
            updateConvertPdfToImgButtonState();
            if (loadingMessagePdfImg) loadingMessagePdfImg.classList.add('hidden');
            if (statusMessagePdfImg) statusMessagePdfImg.classList.add('hidden');
            if (outputFormatSelect) outputFormatSelect.value = 'jpeg';
            if (resolutionScaleSelect) resolutionScaleSelect.value = '1.5';
            if (pageStartInput) pageStartInput.value = '';
            if (pageEndInput) pageEndInput.value = '';
            showMessagePdfImg('info', '<i class="fas fa-info-circle"></i> PDF to Image section cleared.', true);
        }

        // --- Text to PDF Converter Logic ---
        const textToPdfInput = document.getElementById('text-to-pdf-input');
        const convertTextToPdfBtn = document.getElementById('convert-text-to-pdf-btn');
        const loadingMessageTextPdf = document.getElementById('loading-message-text-pdf');
        const statusMessageTextPdf = document.getElementById('status-message-text-pdf');
        const downloadTextPdfLink = document.getElementById('download-text-pdf-link');
        const clearTextPdfBtn = document.getElementById('clear-text-pdf-btn');

        function showMessageTextPdf(type, message, autoHide = false) {
            if (!statusMessageTextPdf) return;
            statusMessageTextPdf.classList.remove('hidden', 'info', 'success', 'error');
            statusMessageTextPdf.classList.add(type);
            statusMessageTextPdf.innerHTML = message;

            if (autoHide) {
                setTimeout(() => {
                    statusMessageTextPdf.classList.add('hidden');
                }, 5000);
            }
        }

        if (convertTextToPdfBtn) {
            convertTextToPdfBtn.addEventListener('click', async () => {
                const textContent = textToPdfInput ? textToPdfInput.value.trim() : '';

                if (textContent === '') {
                    showMessageTextPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please enter some text to convert!', true);
                    return;
                }

                if (convertTextToPdfBtn) {
                    convertTextToPdfBtn.disabled = true;
                    convertTextToPdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
                }
                if (loadingMessageTextPdf) loadingMessageTextPdf.classList.remove('hidden');
                if (statusMessageTextPdf) statusMessageTextPdf.classList.add('hidden');
                if (downloadTextPdfLink) downloadTextPdfLink.classList.add('hidden');
                if (clearTextPdfBtn) clearTextPdfBtn.classList.add('hidden');

                const tempRenderDiv = document.createElement('div');
                tempRenderDiv.style.width = '700px';
                tempRenderDiv.style.padding = '30px';
                tempRenderDiv.style.fontSize = '14px';
                tempRenderDiv.style.fontFamily = 'Inter, sans-serif';
                tempRenderDiv.style.color = '#000';
                tempRenderDiv.style.whiteSpace = 'pre-wrap';
                tempRenderDiv.style.wordWrap = 'break-word';
                tempRenderDiv.style.lineHeight = '1.6';
                tempRenderDiv.innerHTML = textContent.replace(/\n/g, '<br>');

                document.body.appendChild(tempRenderDiv);

                try {
                    const canvas = await html2canvas(tempRenderDiv, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#FFFFFF'
                    });

                    const { jsPDF } = window.jspdf;
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);

                    // Validate imgData
                    if (!imgData || imgData.length < 50) {
                        throw new Error('Failed to generate valid image data from text content.');
                    }

                    const imgCanvasWidth = canvas.width;
                    const imgCanvasHeight = canvas.height;

                    const pdf = new jsPDF('p', 'mm', 'a4');

                    const pdfPageWidth = pdf.internal.pageSize.getWidth();
                    const pdfPageHeight = pdf.internal.pageSize.getHeight();

                    const contentWidthMm = pdfPageWidth - (2 * 10);
                    const imgPdfHeight = imgCanvasHeight * contentWidthMm / imgCanvasWidth;

                    let heightLeft = imgPdfHeight;
                    let position = 0;

                    pdf.addImage(imgData, 'JPEG', 10, 10, contentWidthMm, imgPdfHeight);
                    heightLeft -= (pdfPageHeight - 2 * 10);

                    while (heightLeft > 0) {
                        position = - (imgPdfHeight - heightLeft);
                        pdf.addPage();
                        pdf.addImage(imgData, 'JPEG', 10, position + 10, contentWidthMm, imgPdfHeight);
                        heightLeft -= (pdfPageHeight - 2 * 10);
                    }

                    const pdfBlob = pdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);

                    if (downloadTextPdfLink) {
                        downloadTextPdfLink.href = pdfUrl;
                        downloadTextPdfLink.classList.remove('hidden');
                    }
                    if (clearTextPdfBtn) clearTextPdfBtn.classList.remove('hidden');
                    showMessageTextPdf('success', '<i class="fas fa-check-circle"></i> PDF created successfully! Click "Download Text PDF".', false);

                } catch (error) {
                    console.error('Error generating PDF:', error);
                    showMessageTextPdf('error', `<i class="fas fa-times-circle"></i> Error generating PDF: ${error.message}. Please try again.`, false);
                } finally {
                    document.body.removeChild(tempRenderDiv);
                    if (convertTextToPdfBtn) {
                        convertTextToPdfBtn.disabled = false;
                        convertTextToPdfBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Convert Text to PDF';
                    }
                    if (loadingMessageTextPdf) loadingMessageTextPdf.classList.add('hidden');
                }
            });
        }

        // Clear Text to PDF Section
        if (clearTextPdfBtn) {
            clearTextPdfBtn.addEventListener('click', clearTextToPdfSection);
        }
        function clearTextToPdfSection() {
            if (textToPdfInput) textToPdfInput.value = '';
            if (loadingMessageTextPdf) loadingMessageTextPdf.classList.add('hidden');
            if (statusMessageTextPdf) statusMessageTextPdf.classList.add('hidden');
            if (downloadTextPdfLink) downloadTextPdfLink.classList.add('hidden');
            if (clearTextPdfBtn) clearTextPdfBtn.classList.add('hidden');
            showMessageTextPdf('info', '<i class="fas fa-info-circle"></i> Text to PDF section cleared.', true);
        }

        // --- Rotate PDF Logic ---
        const rotatePdfInput = document.getElementById('rotate-pdf-input');
        const rotatePdfDropArea = document.getElementById('rotate-pdf-drop-area');
        const selectedRotatePdfName = document.getElementById('selected-rotate-pdf-name');
        const rotationDegreeSelect = document.getElementById('rotation-degree');
        const rotatePdfBtn = document.getElementById('rotate-pdf-btn');
        const loadingMessageRotatePdf = document.getElementById('loading-message-rotate-pdf');
        const statusMessageRotatePdf = document.getElementById('status-message-rotate-pdf');
        const downloadRotatePdfLink = document.getElementById('download-rotate-pdf-link');
        const clearRotatePdfBtn = document.getElementById('clear-rotate-pdf-btn');

        if (rotatePdfDropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                rotatePdfDropArea.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                rotatePdfDropArea.addEventListener(eventName, () => rotatePdfDropArea.classList.add('highlight'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                rotatePdfDropArea.addEventListener(eventName, () => rotatePdfDropArea.classList.remove('highlight'), false);
            });
            rotatePdfDropArea.addEventListener('drop', handleRotatePdfDrop, false);
        }

        function handleRotatePdfDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                if (rotatePdfInput) rotatePdfInput.files = files;
                handleRotatePdfFileSelection();
            } else {
                showMessageRotatePdf('error', '<i class="fas fa-exclamation-triangle"></i> Please drop a PDF file.', true);
            }
        }

        if (rotatePdfInput) {
            rotatePdfInput.addEventListener('change', handleRotatePdfFileSelection);
        }

        function handleRotatePdfFileSelection() {
            const file = rotatePdfInput ? rotatePdfInput.files[0] : null;
            if (file) {
                if (selectedRotatePdfName) selectedRotatePdfName.textContent = file.name;
                updateRotatePdfButtonState();
                if (statusMessageRotatePdf) statusMessageRotatePdf.classList.add('hidden');
                if (downloadRotatePdfLink) downloadRotatePdfPdfLink.classList.add('hidden');
                if (clearRotatePdfBtn) clearRotatePdfBtn.classList.remove('hidden');
            } else {
                if (selectedRotatePdfName) selectedRotatePdfName.textContent = 'No file chosen';
                updateRotatePdfButtonState();
                if (clearRotatePdfBtn) clearRotatePdfBtn.classList.add('hidden');
            }
        }

        function updateRotatePdfButtonState() {
            if (rotatePdfBtn) {
                rotatePdfBtn.disabled = !rotatePdfInput || !rotatePdfInput.files || rotatePdfInput.files.length === 0;
            }
        }

        function showMessageRotatePdf(type, message, autoHide = false) {
            if (!statusMessageRotatePdf) return;
            statusMessageRotatePdf.classList.remove('hidden', 'info', 'success', 'error');
            statusMessageRotatePdf.classList.add(type);
            statusMessageRotatePdf.innerHTML = message;
            if (autoHide) {
                setTimeout(() => {
                    statusMessageRotatePdf.classList.add('hidden');
                }, 5000);
            }
        }

        if (rotatePdfBtn) {
            rotatePdfBtn.addEventListener('click', async () => {
                const file = rotatePdfInput ? rotatePdfInput.files[0] : null;
                if (!file) {
                    showMessageRotatePdf('error', '<i class="fas fa-exclamation-triangle"></i> Please select a PDF file.', true);
                    return;
                }

                // Get rotation degree from the select input
                const rotationDegree = parseInt(rotationDegreeSelect ? rotationDegreeSelect.value : '0');

                if (rotatePdfBtn) {
                    rotatePdfBtn.disabled = true;
                    rotatePdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Rotating...';
                }
                if (loadingMessageRotatePdf) loadingMessageRotatePdf.classList.remove('hidden');
                showMessageRotatePdf('info', '<i class="fas fa-info-circle"></i> Rotating PDF...', false);
                if (downloadRotatePdfLink) downloadRotatePdfLink.classList.add('hidden');
                if (clearRotatePdfBtn) clearRotatePdfBtn.classList.add('hidden');

                try {
                    const pdfDoc = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
                    const numPages = pdfDoc.numPages;

                    const newPdf = new jsPDF();
                    newPdf.deletePage(1); // Remove initial blank page

                    for (let i = 1; i <= numPages; i++) {
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1 }); // Use scale 1 for original dimensions

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');

                        let rotatedWidthPt = viewport.width;
                        let rotatedHeightPt = viewport.height;

                        // Adjust canvas dimensions based on rotation
                        if (rotationDegree === 90 || rotationDegree === 270) {
                            [rotatedWidthPt, rotatedHeightPt] = [rotatedHeightPt, rotatedWidthPt]; // Swap dimensions
                        }

                        canvas.width = rotatedWidthPt;
                        canvas.height = rotatedHeightPt;

                        context.save();
                        // Translate to center of canvas for rotation
                        context.translate(canvas.width / 2, canvas.height / 2);
                        context.rotate(rotationDegree * Math.PI / 180);
                        // Translate back, adjusting for original viewport dimensions
                        context.translate(-viewport.width / 2, -viewport.height / 2);

                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        context.restore();

                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        // Validate imgData
                        if (!imgData || imgData.length < 50) {
                            console.error(`Invalid image data generated for PDF page ${i} during rotation. Skipping this page.`);
                            showMessageRotatePdf('error', `<i class="fas fa-exclamation-triangle"></i> Failed to process page ${i} for rotation.`, true);
                            newPdf.addPage([ptToMm(rotatedWidthPt), ptToMm(rotatedHeightPt)]); // Add a blank page to maintain page count
                            continue; // Skip to next page
                        }

                        // Convert rotated canvas dimensions (points) to mm for jsPDF addPage
                        const rotatedWidthMm = ptToMm(rotatedWidthPt);
                        const rotatedHeightMm = ptToMm(rotatedHeightPt);

                        // Pass dimensions as an array [width, height]
                        newPdf.addPage([rotatedWidthMm, rotatedHeightMm]);
                        newPdf.addImage(imgData, 'JPEG', 0, 0, rotatedWidthMm, rotatedHeightMm); // Add image to fit new page
                    }

                    const pdfBlob = newPdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);

                    if (downloadRotatePdfLink) {
                        downloadRotatePdfLink.href = pdfUrl;
                        downloadRotatePdfLink.classList.remove('hidden');
                    }
                    if (clearRotatePdfBtn) clearRotatePdfBtn.classList.remove('hidden');
                    showMessageRotatePdf('success', '<i class="fas fa-check-circle"></i> PDF rotated successfully!', false);

                } catch (error) {
                    console.error("Error during PDF rotation:", error);
                    showMessageRotatePdf('error', `<i class="fas fa-times-circle"></i> Error rotating PDF: ${error.message}. Please try again.`, false);
                } finally {
                    if (rotatePdfBtn) {
                        rotatePdfBtn.disabled = false;
                        rotatePdfBtn.innerHTML = '<i class="fas fa-redo-alt"></i> Rotate PDF';
                    }
                    if (loadingMessageRotatePdf) loadingMessageRotatePdf.classList.add('hidden');
                }
            });
        }

        if (clearRotatePdfBtn) {
            clearRotatePdfBtn.addEventListener('click', clearRotatePdfSection);
        }

        function clearRotatePdfSection() {
            if (rotatePdfInput) rotatePdfInput.value = '';
            if (selectedRotatePdfName) selectedRotatePdfName.textContent = 'No file chosen';
            if (rotationDegreeSelect) rotationDegreeSelect.value = '90';
            updateRotatePdfButtonState();
            if (loadingMessageRotatePdf) loadingMessageRotatePdf.classList.add('hidden');
            if (statusMessageRotatePdf) statusMessageRotatePdf.classList.add('hidden');
            if (downloadRotatePdfLink) downloadRotatePdfLink.classList.add('hidden');
            if (clearRotatePdfBtn) clearRotatePdfBtn.classList.add('hidden');
            showMessageRotatePdf('info', '<i class="fas fa-info-circle"></i> Rotate PDF section cleared.', true);
        }

        // --- Add Page Numbers Logic ---
        const pageNumbersPdfInput = document.getElementById('page-numbers-pdf-input');
        const pageNumbersPdfDropArea = document.getElementById('page-numbers-pdf-drop-area');
        const selectedPageNumbersPdfName = document.getElementById('selected-page-numbers-pdf-name');
        const pageNumberFormatInput = document.getElementById('page-number-format');
        const pageNumberPositionSelect = document.getElementById('page-number-position');
        const pageNumberFontSizeInput = document.getElementById('page-number-font-size');
        const pageNumberColorInput = document.getElementById('page-number-color');
        const pageNumberStartInput = document.getElementById('page-number-start');
        const pageNumberEndInput = document.getElementById('page-number-end');
        const addPageNumbersBtn = document.getElementById('add-page-numbers-btn');
        const loadingMessagePageNumbers = document.getElementById('loading-message-page-numbers');
        const statusMessagePageNumbers = document.getElementById('status-message-page-numbers');
        const downloadPageNumbersLink = document.getElementById('download-page-numbers-link');
        const clearPageNumbersBtn = document.getElementById('clear-page-numbers-btn');

        if (pageNumbersPdfDropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                pageNumbersPdfDropArea.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                pageNumbersPdfDropArea.addEventListener(eventName, () => pageNumbersPdfDropArea.classList.add('highlight'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                pageNumbersPdfDropArea.addEventListener(eventName, () => pageNumbersPdfDropArea.classList.remove('highlight'), false);
            });
            pageNumbersPdfDropArea.addEventListener('drop', handlePageNumbersPdfDrop, false);
        }

        function handlePageNumbersPdfDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                if (pageNumbersPdfInput) pageNumbersPdfInput.files = files;
                handlePageNumbersPdfFileSelection();
            } else {
                showMessagePageNumbers('error', '<i class="fas fa-exclamation-triangle"></i> Please drop a PDF file.', true);
            }
        }

        if (pageNumbersPdfInput) {
            pageNumbersPdfInput.addEventListener('change', handlePageNumbersPdfFileSelection);
        }

        function handlePageNumbersPdfFileSelection() {
            const file = pageNumbersPdfInput ? pageNumbersPdfInput.files[0] : null;
            if (file) {
                if (selectedPageNumbersPdfName) selectedPageNumbersPdfName.textContent = file.name;
                updateAddPageNumbersButtonState();
                if (statusMessagePageNumbers) statusMessagePageNumbers.classList.add('hidden');
                if (downloadPageNumbersLink) downloadPageNumbersLink.classList.add('hidden');
                if (clearPageNumbersBtn) clearPageNumbersBtn.classList.remove('hidden');
            } else {
                if (selectedPageNumbersPdfName) selectedPageNumbersPdfName.textContent = 'No file chosen';
                updateAddPageNumbersButtonState();
                if (clearPageNumbersBtn) clearPageNumbersBtn.classList.add('hidden');
            }
        }

        function updateAddPageNumbersButtonState() {
            if (addPageNumbersBtn) {
                addPageNumbersBtn.disabled = !pageNumbersPdfInput || !pageNumbersPdfInput.files || pageNumbersPdfInput.files.length === 0;
            }
        }

        function showMessagePageNumbers(type, message, autoHide = false) {
            if (!statusMessagePageNumbers) return;
            statusMessagePageNumbers.classList.remove('hidden', 'info', 'success', 'error');
            statusMessagePageNumbers.classList.add(type);
            statusMessagePageNumbers.innerHTML = message;
            if (autoHide) {
                setTimeout(() => {
                    statusMessagePageNumbers.classList.add('hidden');
                }, 5000);
            }
        }

        if (addPageNumbersBtn) {
            addPageNumbersBtn.addEventListener('click', async () => {
                const file = pageNumbersPdfInput ? pageNumbersPdfInput.files[0] : null;
                if (!file) {
                    showMessagePageNumbers('error', '<i class="fas fa-exclamation-triangle"></i> Please select a PDF file.', true);
                    return;
                }

                const format = pageNumberFormatInput ? pageNumberFormatInput.value : 'Page {n} of {total}';
                const position = pageNumberPositionSelect ? pageNumberPositionSelect.value : 'bottom-center';
                const fontSize = parseInt(pageNumberFontSizeInput ? pageNumberFontSizeInput.value : '10');
                const color = pageNumberColorInput ? pageNumberColorInput.value : '#000000';
                const startPageRange = pageNumberStartInput ? parseInt(pageNumberStartInput.value) || 1 : 1;
                const endPageRange = pageNumberEndInput ? parseInt(pageNumberEndInput.value) || Infinity : Infinity;

                if (addPageNumbersBtn) {
                    addPageNumbersBtn.disabled = true;
                    addPageNumbersBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding numbers...';
                }
                if (loadingMessagePageNumbers) loadingMessagePageNumbers.classList.remove('hidden');
                showMessagePageNumbers('info', '<i class="fas fa-info-circle"></i> Adding page numbers to PDF...', false);
                if (downloadPageNumbersLink) downloadPageNumbersLink.classList.add('hidden');
                if (clearPageNumbersBtn) clearPageNumbersBtn.classList.add('hidden');

                try {
                    const pdfDoc = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
                    const numPages = pdfDoc.numPages;

                    const newPdf = new jsPDF();
                    newPdf.deletePage(1); // Remove initial blank page

                    for (let i = 1; i <= numPages; i++) {
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1 }); // Use scale 1 for original dimensions

                        // Get page dimensions in points (pt) or mm for jsPDF
                        const originalPageWidthPt = viewport.width;
                        const originalPageHeightPt = viewport.height;

                        // Convert to mm for jsPDF addPage (assuming 72 DPI for PDF points)
                        const originalPageWidthMm = ptToMm(originalPageWidthPt);
                        const originalPageHeightMm = ptToMm(originalPageHeightPt);

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        await page.render({ canvasContext: context, viewport: viewport }).promise;

                        // Add page number if within specified range
                        if (i >= startPageRange && i <= Math.min(endPageRange, numPages)) {
                            const pageNumberText = format.replace('{n}', i).replace('{total}', numPages);

                            context.font = `${fontSize}px Arial`; // Using Arial as a common fallback font
                            context.fillStyle = color;
                            context.textAlign = 'center';
                            context.textBaseline = 'middle';

                            let x, y;
                            const margin = 20; // pixels from edge

                            switch (position) {
                                case 'top-left':
                                    x = margin;
                                    y = margin;
                                    context.textAlign = 'left';
                                    context.textBaseline = 'top';
                                    break;
                                case 'top-center':
                                    x = canvas.width / 2;
                                    y = margin;
                                    context.textAlign = 'center';
                                    context.textBaseline = 'top';
                                    break;
                                case 'top-right':
                                    x = canvas.width - margin;
                                    y = canvas.height - margin;
                                    context.textAlign = 'right';
                                    context.textBaseline = 'top';
                                    break;
                                case 'bottom-left':
                                    x = margin;
                                    y = canvas.height - margin;
                                    context.textAlign = 'left';
                                    context.textBaseline = 'bottom';
                                    break;
                                case 'bottom-center':
                                    x = canvas.width / 2;
                                    y = canvas.height - margin;
                                    context.textAlign = 'center';
                                    context.textBaseline = 'bottom';
                                    break;
                                case 'bottom-right':
                                    x = canvas.width - margin;
                                    y = canvas.height - margin;
                                    context.textAlign = 'right';
                                    context.textBaseline = 'bottom';
                                    break;
                            }
                            context.fillText(pageNumberText, x, y);
                        }

                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        // Validate imgData
                        if (!imgData || imgData.length < 50) {
                            console.error(`Invalid image data generated for PDF page ${i} during page numbering. Skipping this page.`);
                            showMessagePageNumbers('error', `<i class="fas fa-exclamation-triangle"></i> Failed to process page ${i} for page numbering.`, true);
                            newPdf.addPage([originalPageWidthMm, originalPageHeightMm]); // Add a blank page to maintain page count
                            continue; // Skip to next page
                        }

                        // Pass dimensions as an array [width, height]
                        newPdf.addPage([originalPageWidthMm, originalPageHeightMm]);
                        newPdf.addImage(imgData, 'JPEG', 0, 0, originalPageWidthMm, originalPageHeightMm); // Add image to fit new page
                    }

                    const pdfBlob = newPdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);

                    if (downloadPageNumbersLink) {
                        downloadPageNumbersLink.href = pdfUrl;
                        downloadPageNumbersLink.classList.remove('hidden');
                    }
                    if (clearPageNumbersBtn) clearPageNumbersBtn.classList.remove('hidden');
                    showMessagePageNumbers('success', '<i class="fas fa-check-circle"></i> Page numbers added successfully!', false);

                } catch (error) {
                    console.error("Error adding page numbers:", error);
                    showMessagePageNumbers('error', `<i class="fas fa-times-circle"></i> Error adding page numbers: ${error.message}. Please try again.`, false);
                } finally {
                    if (addPageNumbersBtn) {
                        addPageNumbersBtn.disabled = false;
                        addPageNumbersBtn.innerHTML = '<i class="fas fa-sort-numeric-down"></i> Add Page Numbers';
                    }
                    if (loadingMessagePageNumbers) loadingMessagePageNumbers.classList.add('hidden');
                }
            });
        }

        if (clearPageNumbersBtn) {
            clearPageNumbersBtn.addEventListener('click', clearPageNumbersSection);
        }

        function clearPageNumbersSection() {
            if (pageNumbersPdfInput) pageNumbersPdfInput.value = '';
            if (selectedPageNumbersPdfName) selectedPageNumbersPdfName.textContent = 'No file chosen';
            if (pageNumberFormatInput) pageNumberFormatInput.value = 'Page {n} of {total}';
            if (pageNumberPositionSelect) pageNumberPositionSelect.value = 'bottom-center';
            if (pageNumberFontSizeInput) pageNumberFontSizeInput.value = '10';
            if (pageNumberColorInput) pageNumberColorInput.value = '#000000';
            if (pageNumberStartInput) pageNumberStartInput.value = '';
            if (pageNumberEndInput) pageNumberEndInput.value = '';
            updateAddPageNumbersButtonState();
            if (loadingMessagePageNumbers) loadingMessagePageNumbers.classList.add('hidden');
            if (statusMessagePageNumbers) statusMessagePageNumbers.classList.add('hidden');
            if (downloadPageNumbersLink) downloadPageNumbersLink.classList.add('hidden');
            if (clearPageNumbersBtn) clearPageNumbersBtn.classList.add('hidden');
            showMessagePageNumbers('info', '<i class="fas fa-info-circle"></i> Add Page Numbers section cleared.', true);
        }

        // --- Add Watermark Logic ---
        const watermarkPdfInput = document.getElementById('watermark-pdf-input');
        const watermarkPdfDropArea = document.getElementById('watermark-pdf-drop-area');
        const selectedWatermarkPdfName = document.getElementById('selected-watermark-pdf-name');
        const watermarkTextInput = document.getElementById('watermark-text');
        const watermarkFontSizeInput = document.getElementById('watermark-font-size');
        const watermarkColorInput = document.getElementById('watermark-color');
        const watermarkOpacityInput = document.getElementById('watermark-opacity');
        const watermarkOpacityValueSpan = document.getElementById('watermark-opacity-value');
        const watermarkPositionSelect = document.getElementById('watermark-position');
        const addWatermarkBtn = document.getElementById('add-watermark-btn');
        const loadingMessageWatermark = document.getElementById('loading-message-watermark');
        const statusMessageWatermark = document.getElementById('status-message-watermark');
        const downloadWatermarkLink = document.getElementById('download-watermark-link');
        const clearWatermarkBtn = document.getElementById('clear-watermark-btn');

        if (watermarkPdfDropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                watermarkPdfDropArea.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                watermarkPdfDropArea.addEventListener(eventName, () => watermarkPdfDropArea.classList.add('highlight'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                watermarkPdfDropArea.addEventListener(eventName, () => watermarkPdfDropArea.classList.remove('highlight'), false);
            });
            watermarkPdfDropArea.addEventListener('drop', handleWatermarkPdfDrop, false);
        }

        function handleWatermarkPdfDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                if (watermarkPdfInput) watermarkPdfInput.files = files;
                handleWatermarkPdfFileSelection();
            } else {
                showMessageWatermark('error', '<i class="fas fa-exclamation-triangle"></i> Please drop a PDF file.', true);
            }
        }

        if (watermarkPdfInput) {
            watermarkPdfInput.addEventListener('change', handleWatermarkPdfFileSelection);
        }

        function handleWatermarkPdfFileSelection() {
            const file = watermarkPdfInput ? watermarkPdfInput.files[0] : null;
            if (file) {
                if (selectedWatermarkPdfName) selectedWatermarkPdfName.textContent = file.name;
                updateAddWatermarkButtonState();
                if (statusMessageWatermark) statusMessageWatermark.classList.add('hidden');
                if (downloadWatermarkLink) downloadWatermarkLink.classList.add('hidden');
                if (clearWatermarkBtn) clearWatermarkBtn.classList.remove('hidden');
            } else {
                if (selectedWatermarkPdfName) selectedWatermarkPdfName.textContent = 'No file chosen';
                updateAddWatermarkButtonState();
                if (clearWatermarkBtn) clearWatermarkBtn.classList.add('hidden');
            }
        }

        function updateAddWatermarkButtonState() {
            if (addWatermarkBtn) {
                addWatermarkBtn.disabled = !watermarkPdfInput || !watermarkPdfInput.files || watermarkPdfInput.files.length === 0 || !watermarkTextInput.value.trim();
            }
        }

        function showMessageWatermark(type, message, autoHide = false) {
            if (!statusMessageWatermark) return;
            statusMessageWatermark.classList.remove('hidden', 'info', 'success', 'error');
            statusMessageWatermark.classList.add(type);
            statusMessageWatermark.innerHTML = message;
            if (autoHide) {
                setTimeout(() => {
                    statusMessageWatermark.classList.add('hidden');
                }, 5000);
            }
        }

        if (watermarkOpacityInput) {
            watermarkOpacityInput.addEventListener('input', () => {
                if (watermarkOpacityValueSpan) watermarkOpacityValueSpan.textContent = `${watermarkOpacityInput.value}%`;
            });
        }
        if (watermarkTextInput) {
            watermarkTextInput.addEventListener('input', updateAddWatermarkButtonState);
        }

        if (addWatermarkBtn) {
            addWatermarkBtn.addEventListener('click', async () => {
                const file = watermarkPdfInput ? watermarkPdfInput.files[0] : null;
                if (!file) {
                    showMessageWatermark('error', '<i class="fas fa-exclamation-triangle"></i> Please select a PDF file.', true);
                    return;
                }
                const watermarkText = watermarkTextInput ? watermarkTextInput.value.trim() : '';
                if (!watermarkText) {
                    showMessageWatermark('error', '<i class="fas fa-exclamation-triangle"></i> Please enter watermark text.', true);
                    return;
                }

                const fontSize = parseInt(watermarkFontSizeInput ? watermarkFontSizeInput.value : '48');
                const color = watermarkColorInput ? watermarkColorInput.value : '#CCCCCC';
                const opacity = parseFloat(watermarkOpacityInput ? watermarkOpacityInput.value : '20') / 100;
                const position = watermarkPositionSelect ? watermarkPositionSelect.value : 'diagonal';

                if (addWatermarkBtn) {
                    addWatermarkBtn.disabled = true;
                    addWatermarkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding watermark...';
                }
                if (loadingMessageWatermark) loadingMessageWatermark.classList.remove('hidden');
                showMessageWatermark('info', '<i class="fas fa-info-circle"></i> Adding watermark to PDF...', false);
                if (downloadWatermarkLink) downloadWatermarkLink.classList.add('hidden');
                if (clearWatermarkBtn) clearWatermarkBtn.classList.add('hidden');

                try {
                    const pdfDoc = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
                    const numPages = pdfDoc.numPages;

                    const newPdf = new jsPDF();
                    newPdf.deletePage(1); // Remove initial blank page

                    for (let i = 1; i <= numPages; i++) {
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1 });
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        await page.render({ canvasContext: context, viewport: viewport }).promise;

                        // Add watermark
                        context.save();
                        context.globalAlpha = opacity;
                        context.font = `${fontSize}px Arial`;
                        context.fillStyle = color;
                        context.textAlign = 'center';
                        context.textBaseline = 'middle';

                        if (position === 'diagonal') {
                            const diagonalLength = Math.sqrt(canvas.width * canvas.width + canvas.height * canvas.height);
                            context.translate(canvas.width / 2, canvas.height / 2);
                            context.rotate(-45 * Math.PI / 180); // 45 degrees counter-clockwise
                            context.fillText(watermarkText, 0, 0); // Draw at center after translation
                        } else if (position === 'center') {
                            context.fillText(watermarkText, canvas.width / 2, canvas.height / 2);
                        }
                        context.restore();

                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        // Validate imgData
                        if (!imgData || imgData.length < 50) {
                            console.error(`Invalid image data generated for PDF page ${i} during watermark. Skipping this page.`);
                            showMessageWatermark('error', `<i class="fas fa-exclamation-triangle"></i> Failed to process page ${i} for watermark.`, true);
                            newPdf.addPage([ptToMm(viewport.width), ptToMm(viewport.height)]); // Add a blank page to maintain page count
                            continue; // Skip to next page
                        }

                        const imgPdfWidth = ptToMm(viewport.width); // Convert viewport width to mm
                        const imgPdfHeight = ptToMm(viewport.height); // Convert viewport height to mm

                        newPdf.addPage([imgPdfWidth, imgPdfHeight]); // Add page with correct dimensions in mm
                        newPdf.addImage(imgData, 'JPEG', 0, 0, imgPdfWidth, imgPdfHeight); // Add image to fit new page
                    }

                    const pdfBlob = newPdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);

                    if (downloadWatermarkLink) {
                        downloadWatermarkLink.href = pdfUrl;
                        downloadWatermarkLink.classList.remove('hidden');
                    }
                    if (clearWatermarkBtn) clearWatermarkBtn.classList.remove('hidden');
                    showMessageWatermark('success', '<i class="fas fa-check-circle"></i> Watermark added successfully!', false);

                } catch (error) {
                    console.error("Error adding watermark:", error);
                    showMessageWatermark('error', `<i class="fas fa-times-circle"></i> Error adding watermark: ${error.message}. Please try again.`, false);
                } finally {
                    if (addWatermarkBtn) {
                        addWatermarkBtn.disabled = false;
                        addWatermarkBtn.innerHTML = '<i class="fas fa-tint"></i> Add Watermark';
                    }
                    if (loadingMessageWatermark) loadingMessageWatermark.classList.add('hidden');
                }
            });
        }

        if (clearWatermarkBtn) {
            clearWatermarkBtn.addEventListener('click', clearWatermarkSection);
        }

        function clearWatermarkSection() {
            if (watermarkPdfInput) watermarkPdfInput.value = '';
            if (selectedWatermarkPdfName) selectedWatermarkPdfName.textContent = 'No file chosen';
            if (watermarkTextInput) watermarkTextInput.value = '';
            if (watermarkFontSizeInput) watermarkFontSizeInput.value = '48';
            if (watermarkColorInput) watermarkColorInput.value = '#CCCCCC';
            if (watermarkOpacityInput) watermarkOpacityInput.value = '20';
            if (watermarkOpacityValueSpan) watermarkOpacityValueSpan.textContent = '20%';
            if (watermarkPositionSelect) watermarkPositionSelect.value = 'diagonal';
            updateAddWatermarkButtonState();
            if (loadingMessageWatermark) loadingMessageWatermark.classList.add('hidden');
            if (statusMessageWatermark) statusMessageWatermark.classList.add('hidden');
            if (downloadWatermarkLink) downloadWatermarkLink.classList.add('hidden');
            if (clearWatermarkBtn) clearWatermarkBtn.classList.add('hidden');
            showMessageWatermark('info', '<i class="fas fa-info-circle"></i> Add Watermark section cleared.', true);
        }

        // --- Crop PDF Logic ---
        const cropPdfInput = document.getElementById('crop-pdf-input');
        const cropPdfDropArea = document.getElementById('crop-pdf-drop-area');
        const selectedCropPdfName = document.getElementById('selected-crop-pdf-name');
        const cropXInput = document.getElementById('crop-x');
        const cropYInput = document.getElementById('crop-y');
        const cropWidthInput = document.getElementById('crop-width');
        const cropHeightInput = document.getElementById('crop-height');
        const cropPageStartInput = document.getElementById('crop-page-start');
        const cropPageEndInput = document.getElementById('crop-page-end');
        const cropPdfBtn = document.getElementById('crop-pdf-btn');
        const loadingMessageCropPdf = document.getElementById('loading-message-crop-pdf');
        const statusMessageCropPdf = document.getElementById('status-message-crop-pdf');
        const downloadCropPdfLink = document.getElementById('download-crop-pdf-link');
        const clearCropPdfBtn = document.getElementById('clear-crop-pdf-btn');

        if (cropPdfDropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                cropPdfDropArea.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                cropPdfDropArea.addEventListener(eventName, () => cropPdfDropArea.classList.add('highlight'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                cropPdfDropArea.addEventListener(eventName, () => cropPdfDropArea.classList.remove('highlight'), false);
            });
            cropPdfDropArea.addEventListener('drop', handleCropPdfDrop, false);
        }

        function handleCropPdfDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                if (cropPdfInput) cropPdfInput.files = files;
                handleCropPdfFileSelection();
            } else {
                showMessageCropPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please drop a PDF file.', true);
            }
        }

        if (cropPdfInput) {
            cropPdfInput.addEventListener('change', handleCropPdfFileSelection);
        }

        function handleCropPdfFileSelection() {
            const file = cropPdfInput ? cropPdfInput.files[0] : null;
            if (file) {
                if (selectedCropPdfName) selectedCropPdfName.textContent = file.name;
                updateCropPdfButtonState();
                if (statusMessageCropPdf) statusMessageCropPdf.classList.add('hidden');
                if (downloadCropPdfLink) downloadCropPdfLink.classList.add('hidden');
                if (clearCropPdfBtn) clearCropPdfBtn.classList.remove('hidden');
            } else {
                if (selectedCropPdfName) selectedCropPdfName.textContent = 'No file chosen';
                updateCropPdfButtonState();
                if (clearCropPdfBtn) clearCropPdfBtn.classList.add('hidden');
            }
        }

        function updateCropPdfButtonState() {
            if (cropPdfBtn) {
                cropPdfBtn.disabled = !cropPdfInput || !cropPdfInput.files || cropPdfInput.files.length === 0;
            }
        }

        function showMessageCropPdf(type, message, autoHide = false) {
            if (!statusMessageCropPdf) return;
            statusMessageCropPdf.classList.remove('hidden', 'info', 'success', 'error');
            statusMessageCropPdf.classList.add(type);
            statusMessageCropPdf.innerHTML = message;
            if (autoHide) {
                setTimeout(() => {
                    statusMessageCropPdf.classList.add('hidden');
                }, 5000);
            }
        }

        if (cropPdfBtn) {
            cropPdfBtn.addEventListener('click', async () => {
                const file = cropPdfInput ? cropPdfInput.files[0] : null;
                if (!file) {
                    showMessageCropPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please select a PDF file.', true);
                    return;
                }

                const cropX = parseFloat(cropXInput ? cropXInput.value : '0') || 0;
                const cropY = parseFloat(cropYInput ? cropYInput.value : '0') || 0;
                const cropWidth = parseFloat(cropWidthInput ? cropWidthInput.value : '210') || 210;
                const cropHeight = parseFloat(cropHeightInput ? cropHeightInput.value : '297') || 297;
                const cropStartPage = cropPageStartInput ? parseInt(cropPageStartInput.value) || 1 : 1;
                const cropEndPage = cropPageEndInput ? parseInt(cropPageEndInput.value) || Infinity : Infinity;

                if (cropWidth <= 0 || cropHeight <= 0) {
                    showMessageCropPdf('error', '<i class="fas fa-exclamation-triangle"></i> Crop width and height must be greater than 0.', true);
                    return;
                }

                if (cropPdfBtn) {
                    cropPdfBtn.disabled = true;
                    cropPdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cropping...';
                }
                if (loadingMessageCropPdf) loadingMessageCropPdf.classList.remove('hidden');
                showMessageCropPdf('info', '<i class="fas fa-info-circle"></i> Cropping PDF...', false);
                if (downloadCropPdfLink) downloadCropPdfLink.classList.add('hidden');
                if (clearCropPdfBtn) clearCropPdfBtn.classList.add('hidden');

                try {
                    const pdfDoc = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
                    const numPages = pdfDoc.numPages;

                    const newPdf = new jsPDF();
                    newPdf.deletePage(1); // Remove initial blank page

                    for (let i = 1; i <= numPages; i++) {
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1 });

                        const mmToPx = (mm) => mm * (96 / 25.4); // Assuming 96 DPI for canvas rendering

                        const cropXpx = mmToPx(cropX);
                        const cropYpx = mmToPx(cropY);
                        const cropWidthPx = mmToPx(cropWidth);
                        const cropHeightPx = mmToPx(cropHeight);

                        // Create a temporary canvas to render the full page
                        const tempCanvas = document.createElement('canvas');
                        const tempContext = tempCanvas.getContext('2d');
                        tempCanvas.width = viewport.width;
                        tempCanvas.height = viewport.height;

                        // Render the full page onto the temporary canvas
                        await page.render({ canvasContext: tempContext, viewport: viewport }).promise;

                        // Convert tempCanvas to an Image object for reliable drawImage source
                        const tempCanvasImg = new Image();
                        tempCanvasImg.src = tempCanvas.toDataURL('image/png'); // Use PNG for better quality if alpha is needed
                        await new Promise(resolve => tempCanvasImg.onload = resolve); // Wait for image to load

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');

                        // Set main canvas dimensions to the cropped area dimensions
                        canvas.width = cropWidthPx;
                        canvas.height = cropHeightPx;

                        // Draw the cropped portion from the loaded Image object onto the main canvas
                        context.drawImage(
                            tempCanvasImg, // Use the loaded image instead of the canvas directly
                            cropXpx, cropYpx, // Source X, Y on the original page's canvas
                            cropWidthPx, cropHeightPx, // Source Width, Height
                            0, 0, // Destination X, Y on the new canvas
                            cropWidthPx, cropHeightPx // Destination Width, Height
                        );

                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        // Validate imgData
                        if (!imgData || imgData.length < 50) {
                            console.error(`Invalid image data generated for PDF page ${i} during cropping. Skipping this page.`);
                            showMessageCropPdf('error', `<i class="fas fa-exclamation-triangle"></i> Failed to process page ${i} for cropping.`, true);
                            newPdf.addPage([cropWidth, cropHeight]); // Add a blank page to maintain page count
                            continue; // Skip to next page
                        }

                        // Add page to new PDF with the dimensions of the cropped area
                        newPdf.addPage([cropWidth, cropHeight], 'mm'); // Set page size to cropped dimensions
                        newPdf.addImage(imgData, 'JPEG', 0, 0, cropWidth, cropHeight); // Add image to fit new page
                    }

                    const pdfBlob = newPdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);

                    if (downloadCropPdfLink) {
                        downloadCropPdfLink.href = pdfUrl;
                        downloadCropPdfLink.classList.remove('hidden');
                    }
                    if (clearCropPdfBtn) clearCropPdfBtn.classList.remove('hidden');
                    showMessageCropPdf('success', '<i class="fas fa-check-circle"></i> PDF cropped successfully!', false);

                } catch (error) {
                    console.error("Error cropping PDF:", error);
                    showMessageCropPdf('error', `<i class="fas fa-times-circle"></i> Error cropping PDF: ${error.message}. Please try again.`, false);
                } finally {
                    if (cropPdfBtn) {
                        cropPdfBtn.disabled = false;
                        cropPdfBtn.innerHTML = '<i class="fas fa-crop-alt"></i> Crop PDF';
                    }
                    if (loadingMessageCropPdf) loadingMessageCropPdf.classList.add('hidden');
                }
            });
        }

        if (clearCropPdfBtn) {
            clearCropPdfBtn.addEventListener('click', clearCropPdfSection);
        }

        function clearCropPdfSection() {
            if (cropPdfInput) cropPdfInput.value = '';
            if (selectedCropPdfName) selectedCropPdfName.textContent = 'No file chosen';
            if (cropXInput) cropXInput.value = '0';
            if (cropYInput) cropYInput.value = '0';
            if (cropWidthInput) cropWidthInput.value = '210';
            if (cropHeightInput) cropHeightInput.value = '297';
            if (cropPageStartInput) cropPageStartInput.value = '';
            if (cropPageEndInput) cropPageEndInput.value = '';
            updateCropPdfButtonState();
            if (loadingMessageCropPdf) loadingMessageCropPdf.classList.add('hidden');
            if (statusMessageCropPdf) statusMessageCropPdf.classList.add('hidden');
            if (downloadCropPdfLink) downloadCropPdfLink.classList.add('hidden');
            if (clearCropPdfBtn) clearCropPdfBtn.classList.add('hidden');
            showMessageCropPdf('info', '<i class="fas fa-info-circle"></i> Crop PDF section cleared.', true);
        }

        // --- Add Text to PDF Logic ---
        const addTextPdfInput = document.getElementById('add-text-pdf-input');
        const addTextPdfDropArea = document.getElementById('add-text-pdf-drop-area');
        const selectedAddTextPdfName = document.getElementById('selected-add-text-pdf-name');
        const textToAddInput = document.getElementById('text-to-add');
        const addTextPageNumberInput = document.getElementById('add-text-page-number');
        const addTextFontSizeInput = document.getElementById('add-text-font-size');
        const addTextColorInput = document.getElementById('add-text-color');
        const addTextXInput = document.getElementById('add-text-x');
        const addTextYInput = document.getElementById('add-text-y');
        const addTextToPdfBtn = document.getElementById('add-text-to-pdf-btn');
        const loadingMessageAddTextPdf = document.getElementById('loading-message-add-text-pdf');
        const statusMessageAddTextPdf = document.getElementById('status-message-add-text-pdf');
        const downloadAddTextPdfLink = document.getElementById('download-add-text-pdf-link');
        const clearAddTextPdfBtn = document.getElementById('clear-add-text-pdf-btn');

        if (addTextPdfDropArea) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                addTextPdfDropArea.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                addTextPdfDropArea.addEventListener(eventName, () => addTextPdfDropArea.classList.add('highlight'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                addTextPdfDropArea.addEventListener(eventName, () => addTextPdfDropArea.classList.remove('highlight'), false);
            });
            addTextPdfDropArea.addEventListener('drop', handleAddTextPdfDrop, false);
        }

        function handleAddTextPdfDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                if (addTextPdfInput) addTextPdfInput.files = files;
                handleAddTextPdfFileSelection();
            } else {
                showMessageAddTextPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please drop a PDF file.', true);
            }
        }

        if (addTextPdfInput) {
            addTextPdfInput.addEventListener('change', handleAddTextPdfFileSelection);
        }
        if (textToAddInput) {
            textToAddInput.addEventListener('input', updateAddTextToPdfButtonState);
        }

        function handleAddTextPdfFileSelection() {
            const file = addTextPdfInput ? addTextPdfInput.files[0] : null;
            if (file) {
                if (selectedAddTextPdfName) selectedAddTextPdfName.textContent = file.name;
                updateAddTextToPdfButtonState();
                if (statusMessageAddTextPdf) statusMessageAddTextPdf.classList.add('hidden');
                if (downloadAddTextPdfLink) downloadAddTextPdfLink.classList.add('hidden');
                if (clearAddTextPdfBtn) clearAddTextPdfBtn.classList.remove('hidden');
            } else {
                if (selectedAddTextPdfName) selectedAddTextPdfName.textContent = 'No file chosen';
                updateAddTextToPdfButtonState();
                if (clearAddTextPdfBtn) clearAddTextPdfBtn.classList.add('hidden');
            }
        }

        function updateAddTextToPdfButtonState() {
            if (addTextToPdfBtn) {
                addTextToPdfBtn.disabled = !addTextPdfInput || !addTextPdfInput.files || addTextPdfInput.files.length === 0 || !textToAddInput.value.trim();
            }
        }

        function showMessageAddTextPdf(type, message, autoHide = false) {
            if (!statusMessageAddTextPdf) return;
            statusMessageAddTextPdf.classList.remove('hidden', 'info', 'success', 'error');
            statusMessageAddTextPdf.classList.add(type);
            statusMessageAddTextPdf.innerHTML = message;
            if (autoHide) {
                setTimeout(() => {
                    statusMessageAddTextPdf.classList.add('hidden');
                }, 5000);
            }
        }

        if (addTextToPdfBtn) {
            addTextToPdfBtn.addEventListener('click', async () => {
                const file = addTextPdfInput ? addTextPdfInput.files[0] : null;
                if (!file) {
                    showMessageAddTextPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please select a PDF file.', true);
                    return;
                }
                const textToAdd = textToAddInput ? textToAddInput.value.trim() : '';
                if (!textToAdd) {
                    showMessageAddTextPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please enter text to add.', true);
                    return;
                }

                const targetPageNumber = parseInt(addTextPageNumberInput ? addTextPageNumberInput.value : '1');
                const fontSize = parseInt(addTextFontSizeInput ? addTextFontSizeInput.value : '12');
                const color = addTextColorInput ? addTextColorInput.value : '#000000';
                const xPos = parseFloat(addTextXInput ? addTextXInput.value : '10');
                const yPos = parseFloat(addTextYInput ? addTextYInput.value : '10');

                if (addTextToPdfBtn) {
                    addTextToPdfBtn.disabled = true;
                    addTextToPdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding text...';
                }
                if (loadingMessageAddTextPdf) loadingMessageAddTextPdf.classList.remove('hidden');
                showMessageAddTextPdf('info', '<i class="fas fa-info-circle"></i> Adding text to PDF...', false);
                if (downloadAddTextPdfLink) downloadAddTextPdfLink.classList.add('hidden');
                if (clearAddTextPdfBtn) clearAddTextPdfBtn.classList.add('hidden');

                try {
                    const pdfDoc = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
                    const numPages = pdfDoc.numPages;

                    if (targetPageNumber < 1 || targetPageNumber > numPages) {
                        showMessageAddTextPdf('error', `<i class="fas fa-exclamation-triangle"></i> Invalid page number. PDF has ${numPages} pages.`, true);
                        return;
                    }

                    const newPdf = new jsPDF();
                    newPdf.deletePage(1); // Remove initial blank page

                    for (let i = 1; i <= numPages; i++) {
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1 });
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        await page.render({ canvasContext: context, viewport: viewport }).promise;

                        // Add text only to the target page
                        if (i === targetPageNumber) {
                            context.font = `${fontSize}px Arial`;
                            context.fillStyle = color;
                            context.textAlign = 'left'; // Default to left alignment
                            context.textBaseline = 'top'; // Default to top baseline

                            // Convert mm coordinates to canvas pixels (assuming 96 DPI for canvas)
                            const mmToPx = (mm) => mm * (96 / 25.4);
                            const textXpx = mmToPx(xPos);
                            const textYpx = mmToPx(yPos);

                            context.fillText(textToAdd, textXpx, textYpx);
                        }

                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        // Validate imgData
                        if (!imgData || imgData.length < 50) {
                            console.error(`Invalid image data generated for PDF page ${i} during text addition. Skipping this page.`);
                            showMessageAddTextPdf('error', `<i class="fas fa-exclamation-triangle"></i> Failed to process page ${i} for text addition.`, true);
                            newPdf.addPage([ptToMm(viewport.width), ptToMm(viewport.height)]); // Add a blank page to maintain page count
                            continue; // Skip to next page
                        }

                        const imgPdfWidth = ptToMm(viewport.width); // Convert viewport width to mm
                        const imgPdfHeight = ptToMm(viewport.height); // Convert viewport height to mm

                        // Pass dimensions as an array [width, height]
                        newPdf.addPage([imgPdfWidth, imgPdfHeight]);
                        newPdf.addImage(imgData, 'JPEG', 0, 0, imgPdfWidth, imgPdfHeight); // Add image to fit new page
                    }

                    const pdfBlob = newPdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);

                    if (downloadAddTextPdfLink) {
                        downloadAddTextPdfLink.href = pdfUrl;
                        downloadAddTextPdfLink.classList.remove('hidden');
                    }
                    if (clearAddTextPdfBtn) clearAddTextPdfBtn.classList.remove('hidden');
                    showMessageAddTextPdf('success', '<i class="fas fa-check-circle"></i> Text added successfully!', false);

                } catch (error) {
                    console.error("Error adding text to PDF:", error);
                    showMessageAddTextPdf('error', `<i class="fas fa-times-circle"></i> Error adding text to PDF: ${error.message}. Please try again.`, false);
                } finally {
                    if (addTextToPdfBtn) {
                        addTextToPdfBtn.disabled = false;
                        addTextToPdfBtn.innerHTML = '<i class="fas fa-font"></i> Add Text to PDF';
                    }
                    if (loadingMessageAddTextPdf) loadingMessageAddTextPdf.classList.add('hidden');
                }
            });
        }

        if (clearAddTextPdfBtn) {
            clearAddTextPdfBtn.addEventListener('click', clearAddTextPdfSection);
        }

        function clearAddTextPdfSection() {
            if (addTextPdfInput) addTextPdfInput.value = '';
            if (selectedAddTextPdfName) selectedAddTextPdfName.textContent = 'No file chosen';
            if (textToAddInput) textToAddInput.value = '';
            if (addTextPageNumberInput) addTextPageNumberInput.value = '1';
            if (addTextFontSizeInput) addTextFontSizeInput.value = '12';
            if (addTextColorInput) addTextColorInput.value = '#000000';
            if (addTextXInput) addTextXInput.value = '10';
            if (addTextYInput) addTextYInput.value = '10';
            updateAddTextToPdfButtonState();
            if (loadingMessageAddTextPdf) loadingMessageAddTextPdf.classList.add('hidden');
            if (statusMessageAddTextPdf) statusMessageAddTextPdf.classList.add('hidden');
            if (downloadAddTextPdfLink) downloadAddTextPdfLink.classList.add('hidden');
            if (clearAddTextPdfBtn) clearAddTextPdfBtn.classList.add('hidden');
            showMessageAddTextPdf('info', '<i class="fas fa-info-circle"></i> Add Text to PDF section cleared.', true);
        }


        // --- Resume Builder Logic ---
        const resumeTemplateSelection = document.getElementById('template-selection');
        const resumePreview = document.getElementById('resume-preview');
        const fontSelect = document.getElementById('font-select');
        const primaryColorInput = document.getElementById('primary-color');
        const sectionOrderList = document.getElementById('section-order-list');
        const generateResumePdfBtn = document.getElementById('generate-resume-pdf-btn');
        const downloadResumePdfLink = document.getElementById('download-resume-pdf-link');
        const loadingMessageResumePdf = document.getElementById('loading-message-resume-pdf');
        const statusMessageResumePdf = document.getElementById('status-message-resume-pdf');
        const clearResumeBtn = document.getElementById('clear-resume-btn');

        const bulletTypeSelect = document.getElementById('bullet-type');
        const listLineHeightInput = document.getElementById('list-line-height');
        const listLineHeightValueSpan = document.getElementById('list-line-height-value');

        const toggleProjectFormBtn = document.getElementById('toggle-project-form-btn');
        const projectInputForm = document.getElementById('project-input-form');
        const saveProjectBtn = document.getElementById('save-project-btn');
        const cancelProjectBtn = document.getElementById('cancel-project-btn');
        const projectTitleInput = document.getElementById('project-title');
        const projectDateInput = document.getElementById('project-date');
        const projectDescriptionInput = document.getElementById('project-description');
        const projectLinkInput = document.getElementById('project-link');

        let resumeData = {
            personalInfo: {
                name: '',
                title: '',
                email: '',
                phone: '',
                linkedin: '',
                website: ''
            },
            summary: '',
            experience: [],
            education: [],
            skills: '',
            projects: [],
            awards: []
        };

        let currentTemplate = 'modern';
        let currentFont = 'Inter';
        let currentPrimaryColor = '#6366f1';
        let resumeSectionsOrder = ['personalInfo', 'summary', 'experience', 'education', 'skills', 'projects', 'awards'];
        let pdfOutputType = 'multi-page';

        // --- Data Input Event Listeners ---
        const textInputs = ['name-input', 'title-input', 'email-input', 'phone-input', 'linkedin-input', 'website-input', 'summary-input', 'skills-input'];
        textInputs.forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', updateResumeDataAndPreview);
            }
        });

        function setupDynamicSection(addBtnId, entriesContainerId, dataArrayName, templateFn) {
            const addBtn = document.getElementById(addBtnId);
            if (addBtn) {
                addBtn.addEventListener('click', () => {
                    resumeData[dataArrayName].push({});
                    renderDynamicSection(entriesContainerId, dataArrayName, templateFn);
                    updateResumePreview();
                });
            }
        }

        function renderDynamicSection(entriesContainerId, dataArrayName, templateFn) {
            const container = document.getElementById(entriesContainerId);
            if (!container) return;
            container.innerHTML = '';
            resumeData[dataArrayName].forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                // Added more padding and margin-bottom for better visual separation
                entryDiv.classList.add('p-4', 'border', 'border-gray-600', 'rounded-md', 'bg-gray-700', 'relative', 'mb-4');
                entryDiv.innerHTML = templateFn(entry, index);

                // Add labels for better accessibility and UI
                entryDiv.querySelectorAll('input, textarea').forEach(input => {
                    const labelText = input.placeholder || input.id.replace(/-/g, ' ').replace('input', '').trim();
                    const label = document.createElement('label');
                    label.setAttribute('for', input.id + '-' + index); // Unique ID for label
                    label.classList.add('block', 'text-gray-400', 'font-medium', 'mb-1', 'text-left');
                    label.textContent = labelText + ':';
                    input.setAttribute('id', input.id + '-' + index); // Set unique ID for input
                    input.parentNode.insertBefore(label, input);

                    input.addEventListener('input', (e) => {
                        const field = e.target.dataset.field;
                        resumeData[dataArrayName][index][field] = e.target.value;
                        updateResumePreview();
                    });
                });

                const removeBtn = entryDiv.querySelector('.remove-entry-btn');
                if (removeBtn) {
                    removeBtn.addEventListener('click', () => {
                        resumeData[dataArrayName].splice(index, 1);
                        renderDynamicSection(entriesContainerId, dataArrayName, templateFn);
                        updateResumePreview();
                    });
                }

                container.appendChild(entryDiv);
            });
        }

        const experienceTemplate = (entry, index) => `
            <div class="dynamic-entry-fields grid-2-cols">
                <div><input type="text" data-field="title" value="${entry.title || ''}" placeholder="Job Title" class="form-input"></div>
                <div><input type="text" data-field="company" value="${entry.company || ''}" placeholder="Company Name" class="form-input"></div>
                <div class="col-span-full"><input type="text" data-field="dates" value="${entry.dates || ''}" placeholder="Start Date - End Date (e.g., 2020 - Present)" class="form-input"></div>
                <div class="col-span-full"><textarea data-field="description" rows="3" placeholder="Responsibilities and achievements (use bullet points or line breaks)" class="form-input">${entry.description || ''}</textarea></div>
            </div>
            <button class="remove-entry-btn btn-remove-entry" title="Remove Entry"><i class="fas fa-times"></i></button>
        `;
        const educationTemplate = (entry, index) => `
            <div class="dynamic-entry-fields grid-2-cols">
                <div><input type="text" data-field="degree" value="${entry.degree || ''}" placeholder="Degree/Major" class="form-input"></div>
                <div><input type="text" data-field="institution" value="${entry.institution || ''}" placeholder="Institution Name" class="form-input"></div>
                <div class="col-span-full"><input type="text" data-field="dates" value="${entry.dates || ''}" placeholder="Years (e.g., 2016 - 2020)" class="form-input"></div>
                <div class="col-span-full"><textarea data-field="description" rows="2" placeholder="Relevant coursework, honors, GPA (optional)" class="form-input">${entry.description || ''}</textarea></div>
            </div>
            <button class="remove-entry-btn btn-remove-entry" title="Remove Entry"><i class="fas fa-times"></i></button>
        `;
        const projectTemplate = (entry, index) => `
            <div class="dynamic-entry-fields grid-2-cols">
                <div><input type="text" data-field="title" value="${entry.title || ''}" placeholder="Project Title" class="form-input"></div>
                <div><input type="text" data-field="dates" value="${entry.dates || ''}" placeholder="Dates (e.g., Jan 2023 - Mar 2023)" class="form-input"></div>
                <div class="col-span-full"><input type="text" data-field="link" value="${entry.link || ''}" placeholder="Project Link (optional)" class="form-input"></div>
                <div class="col-span-full"><textarea data-field="description" rows="3" placeholder="Description of your role and achievements" class="form-input">${entry.description || ''}</textarea></div>
            </div>
            <button class="remove-entry-btn btn-remove-entry" title="Remove Entry"><i class="fas fa-times"></i></button>
        `;
        const awardTemplate = (entry, index) => `
            <div class="dynamic-entry-fields grid-2-cols">
                <div><input type="text" data-field="title" value="${entry.title || ''}" placeholder="Award/Certification Name" class="form-input"></div>
                <div><input type="text" data-field="date" value="${entry.date || ''}" placeholder="Date (e.g., May 2024)" class="form-input"></div>
                <div class="col-span-full"><textarea data-field="description" rows="2" placeholder="Description or significance" class="form-input">${entry.description || ''}</textarea></div>
            </div>
            <button class="remove-entry-btn btn-remove-entry" title="Remove Entry"><i class="fas fa-times"></i></button>
        `;

        setupDynamicSection('add-experience-btn', 'experience-entries', 'experience', experienceTemplate);
        setupDynamicSection('add-education-btn', 'education-entries', 'education', educationTemplate);
        setupDynamicSection('add-project-btn', 'project-entries', 'projects', projectTemplate);
        setupDynamicSection('add-award-btn', 'award-entries', 'awards', awardTemplate);

        // Toggle Project Form
        if (toggleProjectFormBtn && projectInputForm) {
            toggleProjectFormBtn.addEventListener('click', () => {
                projectInputForm.classList.toggle('expanded');
                // Clear form fields when opening
                if (projectInputForm.classList.contains('expanded')) {
                    if (projectTitleInput) projectTitleInput.value = '';
                    if (projectDateInput) projectDateInput.value = '';
                    if (projectDescriptionInput) projectDescriptionInput.value = '';
                    if (projectLinkInput) projectLinkInput.value = '';
                }
            });
        }

        if (cancelProjectBtn) {
            cancelProjectBtn.addEventListener('click', () => {
                if (projectInputForm) projectInputForm.classList.remove('expanded');
            });
        }

        if (saveProjectBtn) {
            saveProjectBtn.addEventListener('click', () => {
                const newProject = {
                    title: projectTitleInput ? projectTitleInput.value.trim() : '',
                    dates: projectDateInput ? projectDateInput.value.trim() : '',
                    description: projectDescriptionInput ? projectDescriptionInput.value.trim() : '',
                    link: projectLinkInput ? projectLinkInput.value.trim() : ''
                };

                if (newProject.title || newProject.dates || newProject.description || newProject.link) {
                    resumeData.projects.push(newProject);
                    renderDynamicSection('project-entries', 'projects', projectTemplate); // Re-render projects
                    updateResumePreview();
                    if (projectInputForm) projectInputForm.classList.remove('expanded');
                    showMessageResumePdf('success', '<i class="fas fa-check-circle"></i> Project added successfully!', true);
                } else {
                    showMessageResumePdf('error', '<i class="fas fa-exclamation-triangle"></i> Project fields cannot be empty to save.', true);
                }
            });
        }


        function updateResumeDataAndPreview(e) {
            const id = e.target.id;
            const value = e.target.value;

            if (id === 'name-input') resumeData.personalInfo.name = value;
            else if (id === 'title-input') resumeData.personalInfo.title = value;
            else if (id === 'email-input') resumeData.personalInfo.email = value;
            else if (id === 'phone-input') resumeData.personalInfo.phone = value;
            else if (id === 'linkedin-input') resumeData.personalInfo.linkedin = value;
            else if (id === 'website-input') resumeData.personalInfo.website = value;
            else if (id === 'summary-input') resumeData.summary = value;
            else if (id === 'skills-input') resumeData.skills = value;

            updateResumePreview();
        }

        // --- Customization Event Listeners ---
        if (resumeTemplateSelection) {
            resumeTemplateSelection.addEventListener('click', (e) => {
                const targetButton = e.target.closest('.template-card');
                if (targetButton) {
                    document.querySelectorAll('.template-card').forEach(btn => btn.classList.remove('active'));
                    targetButton.classList.add('active');
                    currentTemplate = targetButton.dataset.template;
                    if (resumePreview) resumePreview.className = `resume-template ${currentTemplate}`;
                    updateResumePreview();
                }
            });
        }

        if (fontSelect) {
            fontSelect.addEventListener('change', (e) => {
                currentFont = e.target.value;
                document.documentElement.style.setProperty('--font-family', `'${currentFont}', sans-serif`);
                updateResumePreview();
            });
        }

        if (primaryColorInput) {
            primaryColorInput.addEventListener('input', (e) => {
                currentPrimaryColor = e.target.value;
                document.documentElement.style.setProperty('--primary-color', currentPrimaryColor);
                updateResumePreview();
            });
        }

        if (bulletTypeSelect) {
            bulletTypeSelect.addEventListener('change', (e) => {
                const selectedBulletType = e.target.value;
                document.documentElement.style.setProperty('--bullet-type', selectedBulletType);
                updateResumePreview();
            });
        }

        if (listLineHeightInput) {
            listLineHeightInput.addEventListener('input', (e) => {
                const lineHeight = e.target.value;
                if (listLineHeightValueSpan) listLineHeightValueSpan.textContent = `${lineHeight}x`;
                document.documentElement.style.setProperty('--list-line-height', lineHeight);
                updateResumePreview();
            });
        }

        // --- Section Reordering ---
        function renderSectionOrderList() {
            if (!sectionOrderList) return;
            sectionOrderList.innerHTML = '';
            resumeSectionsOrder.forEach(sectionKey => {
                const li = document.createElement('li');
                li.classList.add('section-item');
                li.setAttribute('data-section', sectionKey);
                li.innerHTML = `<i class="fas fa-grip-vertical drag-handle"></i> ${sectionKey.charAt(0).toUpperCase() + sectionKey.slice(1).replace(/([A-Z])/g, ' $1')}`;
                sectionOrderList.appendChild(li);
            });
        }

        if (sectionOrderList) {
            new Sortable(sectionOrderList, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                handle: '.drag-handle', // Specify drag handle
                onEnd: function (evt) {
                    const oldIndex = evt.oldIndex;
                    const newIndex = evt.newIndex;
                    const [movedItem] = resumeSectionsOrder.splice(oldIndex, 1);
                    resumeSectionsOrder.splice(newIndex, 0, movedItem);
                },
            });
        }

        // --- Resume Preview Rendering ---
        function updateResumePreview() {
            if (!resumePreview) return;
            let htmlContent = '';

            const personal = resumeData.personalInfo;
            const contactInfo = `
                ${personal.email ? `<span>${personal.email}</span>` : ''}
                ${personal.phone ? `<span>${personal.phone}</span>` : ''}
                ${personal.linkedin ? `<span><a href="${personal.linkedin}" target="_blank" style="color: inherit; text-decoration: none;">LinkedIn</a></span>` : ''}
                ${personal.website ? `<span><a href="${personal.website}" target="_blank" style="color: inherit; text-decoration: none;">Website</a></span>` : ''}
            `.trim();

            if (currentTemplate === 'modern') {
                 htmlContent += `
                    <div class="header-section">
                        <h1>${personal.name || 'Your Name'}</h1>
                        <p>${personal.title || 'Professional Title'}</p>
                        <div class="contact-info">
                            ${contactInfo}
                        </div>
                    </div>
                `;
            } else if (currentTemplate === 'classic') {
                htmlContent += `
                    <div class="header-section">
                        <h1>${personal.name || 'Your Name'}</h1>
                        <p>${personal.title || 'Professional Title'}</p>
                        <div class="contact-info">
                            ${contactInfo}
                        </div>
                    </div>
                `;
            } else if (currentTemplate === 'minimal') {
                htmlContent += `
                    <div class="header-section">
                        <h1>${personal.name || 'Your Name'}</h1>
                        <p>${personal.title || 'Professional Title'}</p>
                        <div class="contact-info">
                             ${personal.email ? `<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M1.5 8.67v8.58L12 21.43l10.5-4.18V8.67L12 5.5l-10.5 3.17Z" /><path d="M1.5 8.67 12 5.5l10.5 3.17m-10.5 12.76v-5.64" /><path d="M22.5 8.67V17.25a.75.75 0 0 1-.75.75H12" /><path d="M1.5 8.67v8.58a.75.75 0 0 0 .75.75H12m0 0v-5.64m0 0V5.5L1.5 8.67Z" /></svg>${personal.email}</span>` : ''}
                            ${personal.phone ? `<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.85 1.404l.804 2.833 1.258.92c.181.133.204.347.106.529l-.956 1.764c-.16.295-.366.574-.608.822L5.857 18.25c-1.205 1.204-1.823 2.593-1.823 4.25H3a.75.75 0 0 1-.75-.75V4.5A3 3 0 0 1 1.5 4.5Zm11.838 9.526-.804 2.833-1.258-.92a.75.75 0 0 1-.106-.529l.956-1.764c.16-.295.366-.574.608-.822L17.143 5.75c1.205-1.204 1.823-2.593 1.823-4.25h1.275a.75.75 0 0 1 .75.75V19.5a3 3 0 0 1-3 3h-1.372a.75.75 0 0 1-.722-.533l-.804-2.833-1.258-.92a.75.75 0 0 1-.106-.529l.956-1.764c.16-.295.366-.574.608-.822L18.143 6.75c1.205-1.204 1.823-2.593 1.823-4.25h1.275a.75.75 0 0 1 .75.75V19.5a3 3 0 0 1-3 3h-1.372a.75.75 0 0 1-.722-.533Z" clip-rule="evenodd" /></svg>${personal.phone}</span>` : ''}
                            ${personal.linkedin ? `<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M19.5 2.25A2.25 2.25 0 0 0 17.25 0H6.75A2.25 2.25 0 0 0 4.5 2.25v19.5A2.25 2.25 0 0 0 6.75 24h10.5A2.25 2.25 0 0 0 19.5 21.75V2.25Zm-9 11.25h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Zm0-3h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Zm0-3h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Zm6 7.5h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Zm0-3h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Zm0-3h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Z" clip-rule="evenodd" /><path d="M17.25 3H6.75a.75.75 0 0 0-.75.75v16.5a.75.75 0 0 0 .75.75h10.5a.75.75 0 0 0 .75-.75V3.75a.75.75 0 0 0-.75-.75ZM15 7.5h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Zm0 3h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Zm0 3h-3.75a.75.75 0 0 1 0-1.5h3.75a.75.75 0 0 1 0 1.5Z" /></svg><a href="${personal.linkedin}" target="_blank" style="color: inherit; text-decoration: none;">LinkedIn</a></span>` : ''}
                            ${personal.website ? `<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M7.747 1.5a.75.75 0 0 1 .75.75V4.5h6V2.25a.75.75 0 0 1 1.5 0V4.5h1.253a2.25 2.25 0 0 1 2.25 2.25v9.5A2.25 2.25 0 0 1 18.747 18H5.253a2.25 2.25 0 0 1-2.25-2.25v-9.5A2.25 2.25 0 0 1 5.253 4.5H6.75V2.25a.75.75 0 0 1 .75-.75Zm.75 3h6V2.25a.75.75 0 0 0-1.5 0V4.5H8.25V2.25a.75.75 0 0 0-1.5 0V4.5H5.253a.75.75 0 0 0-.75.75v9.5a.75.75 0 0 0 .75.75h13.494a.75.75 0 0 0 .75-.75v-9.5a.75.75 0 0 0-.75-.75H17.25V2.25a.75.75 0 0 0-1.5 0V4.5h-6V2.25a.75.75 0 0 0-1.5 0V4.5h-1.253a.75.75 0 0 0-.75.75v9.5a.75.75 0 0 0 .75.75H18.747a.75.75 0 0 0 .75-.75v-9.5a.75.75 0 0 0-.75-.75H5.253a2.25 2.25 0 0 1 2.25-2.25Z" clip-rule="evenodd" /><path d="M12 21a.75.75 0 0 1-.75-.75v-3.5a.75.75 0 0 1 1.5 0v3.5a.75.75 0 0 1-.75.75Z" /></svg><a href="${personal.website}" target="_blank" style="color: inherit; text-decoration: none;">Website</a></span>` : ''}
                        </div>
                    </div>
                `;
            }

            resumeSectionsOrder.forEach(sectionKey => {
                const sectionData = resumeData[sectionKey];

                if (!sectionData || (Array.isArray(sectionData) && sectionData.length === 0) || (typeof sectionData === 'string' && !sectionData.trim())) {
                    return;
                }

                if (sectionKey === 'summary') {
                    htmlContent += `
                        <div class="section">
                            <h2>Summary</h2>
                            <div class="section-content">
                                <p>${sectionData.replace(/\n/g, '<br>')}</p>
                            </div>
                        </div>
                    `;
                } else if (sectionKey === 'experience') {
                    htmlContent += `
                        <div class="section">
                            <h2>Experience</h2>
                            <div class="section-content">
                                ${sectionData.map(exp => `
                                    <h3>${exp.title || 'Job Title'} at ${exp.company || 'Company Name'}</h3>
                                    <p class="meta-info">${exp.dates || 'Dates of Employment'}</p>
                                    <ul>${exp.description ? exp.description.split('\n').filter(line => line.trim()).map(line => `<li>${line.trim()}</li>`).join('') : ''}</ul>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (sectionKey === 'education') {
                    htmlContent += `
                        <div class="section">
                            <h2>Education</h2>
                            <div class="section-content">
                                ${sectionData.map(edu => `
                                    <h3>${edu.degree || 'Degree/Major'}</h3>
                                    <p class="meta-info">${edu.institution || 'Institution Name'} | ${edu.dates || 'Years'}</p>
                                    ${edu.description ? `<p>${edu.description}</p>` : ''}
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (sectionKey === 'skills') {
                    const skillsArray = sectionData.split(',').map(s => s.trim()).filter(s => s);
                    if (skillsArray.length > 0) {
                        htmlContent += `
                            <div class="section">
                                <h2>Skills</h2>
                                <div class="section-content">
                                    <ul class="skills-list">
                                        ${skillsArray.map(skill => `<li>${skill}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `;
                    }
                } else if (sectionKey === 'projects') {
                    htmlContent += `
                        <div class="section">
                            <h2>Projects</h2>
                            <div class="section-content">
                                ${sectionData.map(proj => `
                                    <h3>${proj.title || 'Project Title'}</h3>
                                    <p class="meta-info">${proj.dates || 'Dates'} ${proj.link ? `| <a href="${proj.link}" target="_blank" style="color: inherit;">Link</a>` : ''}</p>
                                    <ul>${proj.description ? proj.description.split('\n').filter(line => line.trim()).map(line => `<li>${line.trim()}</li>`).join('') : ''}</ul>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (sectionKey === 'awards') {
                    htmlContent += `
                        <div class="section">
                            <h2>Awards & Certifications</h2>
                            <div class="section-content">
                                ${sectionData.map(award => `
                                    <h3>${award.title || 'Award/Certification'}</h3>
                                    <p class="meta-info">${award.date || 'Date'}</p>
                                    ${award.description ? `<p>${award.description}</p>` : ''}
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            resumePreview.innerHTML = htmlContent;
        }

        // --- Generate Resume PDF ---
        if (generateResumePdfBtn) {
            generateResumePdfBtn.addEventListener('click', async () => {
                if (generateResumePdfBtn) {
                    generateResumePdfBtn.disabled = true;
                    generateResumePdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                }
                if (loadingMessageResumePdf) loadingMessageResumePdf.classList.remove('hidden');
                if (statusMessageResumePdf) statusMessageResumePdf.classList.add('hidden');
                if (downloadResumePdfLink) downloadResumePdfLink.classList.add('hidden');
                if (clearResumeBtn) clearResumeBtn.classList.add('hidden');

                const originalPreviewPadding = resumePreview ? resumePreview.style.padding : '';
                const originalPreviewFontSize = resumePreview ? resumePreview.style.fontSize : '';
                const originalPreviewLineHeight = resumePreview ? resumePreview.style.lineHeight : '';

                try {
                    if (!resumePreview) {
                        showMessageResumePdf('error', '<i class="fas fa-exclamation-triangle"></i> Resume preview element not found.', true);
                        return;
                    }

                    resumePreview.style.padding = '0px';
                    resumePreview.style.display = 'block';
                    resumePreview.style.overflow = 'visible';

                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pdfPageWidth = pdf.internal.pageSize.getWidth();
                    const pdfPageHeight = pdf.internal.pageSize.getHeight();
                    const pdfMargin = 10;

                    const contentWidthMm = pdfPageWidth - (2 * pdfMargin);
                    const contentHeightMm = pdfPageHeight - (2 * pdfMargin);

                    const canvas = await html2canvas(resumePreview, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#FFFFFF'
                    });

                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    // Validate imgData
                    if (!imgData || imgData.length < 50) {
                        throw new Error('Failed to generate valid image data from resume preview.');
                    }

                    const imgCanvasWidth = canvas.width;
                    const imgCanvasHeight = canvas.height;

                    const imgPdfHeight = imgCanvasHeight * (contentWidthMm / imgCanvasWidth);

                    let currentContentY = 0;
                    let currentPage = 1;

                    while (currentContentY < imgCanvasHeight) {
                        if (currentPage > 1) {
                            pdf.addPage();
                        }

                        const sliceHeightInPdfContentArea = contentHeightMm;
                        const sliceHeightInCanvas = sliceHeightInPdfContentArea * (imgCanvasWidth / contentWidthMm);

                        const tempSliceCanvas = document.createElement('canvas');
                        tempSliceCanvas.width = imgCanvasWidth;
                        tempSliceCanvas.height = Math.min(sliceHeightInCanvas, imgCanvasHeight - currentContentY);
                        const tempSliceContext = tempSliceCanvas.getContext('2d');

                        tempSliceContext.drawImage(
                            canvas,
                            0, currentContentY,
                            imgCanvasWidth, tempSliceCanvas.height,
                            0, 0,
                            tempSliceCanvas.width, tempSliceCanvas.height
                        );

                        const sliceImgData = tempSliceCanvas.toDataURL('image/jpeg', 1.0);
                        // Validate sliceImgData
                        if (!sliceImgData || sliceImgData.length < 50) {
                            console.error(`Invalid image data generated for resume slice on page ${currentPage}. Skipping this slice.`);
                            // Attempt to add a blank page to maintain structure
                            pdf.addPage();
                            currentContentY += sliceHeightInCanvas;
                            currentPage++;
                            continue;
                        }

                        pdf.addImage(
                            sliceImgData,
                            'JPEG',
                            pdfMargin,
                            pdfMargin,
                            contentWidthMm,
                            tempSliceCanvas.height * (contentWidthMm / imgCanvasWidth)
                        );

                        currentContentY += sliceHeightInCanvas;
                        currentPage++;
                    }
                    showMessageResumePdf('success', '<i class="fas fa-check-circle"></i> Multi-page PDF generated successfully!', false);

                    const pdfBlob = pdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);

                    if (downloadResumePdfLink) {
                        downloadResumePdfLink.href = pdfUrl;
                        downloadResumePdfLink.classList.remove('hidden');
                    }
                    if (clearResumeBtn) clearResumeBtn.classList.remove('hidden');

                } catch (error) {
                    console.error("Error generating resume PDF:", error);
                    showMessageResumePdf('error', `<i class="fas fa-times-circle"></i> Failed to generate PDF: ${error.message}. Please check your content.`, false);
                } finally {
                    if (resumePreview) {
                        resumePreview.style.padding = originalPreviewPadding;
                        resumePreview.style.fontSize = originalPreviewFontSize;
                        resumePreview.style.lineHeight = originalPreviewLineHeight;
                    }

                    if (generateResumePdfBtn) {
                        generateResumePdfBtn.disabled = false;
                        generateResumePdfBtn.innerHTML = '<i class="fas fa-file-alt"></i> Generate Resume PDF';
                    }
                    if (loadingMessageResumePdf) loadingMessageResumePdf.classList.add('hidden');
                }
            });
        }

        function showMessageResumePdf(type, message, autoHide = false) {
            if (!statusMessageResumePdf) return;
            statusMessageResumePdf.classList.remove('hidden', 'info', 'success', 'error');
            statusMessageResumePdf.classList.add(type);
            statusMessageResumePdf.innerHTML = message;

            if (autoHide) {
                setTimeout(() => {
                    statusMessageResumePdf.classList.add('hidden');
                }, 5000);
            }
        }

        // Clear Resume Builder Section
        if (clearResumeBtn) {
            clearResumeBtn.addEventListener('click', clearResumeBuilderSection);
        }
        function clearResumeBuilderSection() {
            resumeData = {
                personalInfo: {
                    name: '',
                    title: '',
                    email: '',
                    phone: '',
                    linkedin: '',
                    website: ''
                },
                summary: '',
                experience: [],
                education: [],
                skills: '',
                projects: [],
                awards: []
            };

            const inputs = document.querySelectorAll('#resume-builder-section .form-input');
            inputs.forEach(input => { input.value = ''; });

            renderDynamicSection('experience-entries', 'experience', experienceTemplate);
            renderDynamicSection('education-entries', 'education', educationTemplate);
            renderDynamicSection('project-entries', 'projects', projectTemplate);
            renderDynamicSection('award-entries', 'awards', awardTemplate);

            if (document.querySelectorAll('.template-card')) {
                document.querySelectorAll('.template-card').forEach(btn => btn.classList.remove('active'));
                const modernTemplateBtn = document.querySelector('.template-card[data-template="modern"]');
                if (modernTemplateBtn) modernTemplateBtn.classList.add('active');
            }
            currentTemplate = 'modern';

            if (fontSelect) fontSelect.value = 'Inter';
            document.documentElement.style.setProperty('--font-family', `'Inter', sans-serif`);

            if (primaryColorInput) primaryColorInput.value = '#6366f1';
            document.documentElement.style.setProperty('--primary-color', '#6366f1');

            if (bulletTypeSelect) bulletTypeSelect.value = 'disc';
            document.documentElement.style.setProperty('--bullet-type', 'disc');

            if (listLineHeightInput) listLineHeightInput.value = '1.5';
            if (listLineHeightValueSpan) listLineHeightValueSpan.textContent = '1.5x';
            document.documentElement.style.setProperty('--list-line-height', '1.5');

            resumeSectionsOrder = ['personalInfo', 'summary', 'experience', 'education', 'skills', 'projects', 'awards'];
            renderSectionOrderList();

            if (downloadResumePdfLink) downloadResumePdfLink.classList.add('hidden');
            if (loadingMessageResumePdf) loadingMessageResumePdf.classList.add('hidden');
            if (statusMessageResumePdf) statusMessageResumePdf.classList.add('hidden');
            if (clearResumeBtn) clearResumeBtn.classList.add('hidden');
            if (projectInputForm) projectInputForm.classList.remove('expanded'); // Collapse project form

            updateResumePreview();
            showMessageResumePdf('info', '<i class="fas fa-info-circle"></i> Resume Builder section cleared.', true);
        }

        // --- Simple Note Taker Logic ---
        const noteInput = document.getElementById('noteInput');
        const saveNoteButton = document.querySelector('.save-note-button');
        const notesList = document.getElementById('notesList');
        const noNotesMessage = document.querySelector('.no-notes-message');

        let notes = [];

        function loadNotes() {
            const storedNotes = localStorage.getItem('evexaNotes');
            if (storedNotes) {
                notes = JSON.parse(storedNotes);
            } else {
                notes = [];
            }
            renderNotes();
        }

        function saveNotes() {
            localStorage.setItem('evexaNotes', JSON.stringify(notes));
        }

        function renderNotes() {
            if (!notesList) return;
            notesList.innerHTML = '';

            if (notes.length === 0) {
                if (noNotesMessage) noNotesMessage.style.display = 'block';
            } else {
                if (noNotesMessage) noNotesMessage.style.display = 'none';
                notes.forEach((note, index) => {
                    const noteItem = document.createElement('li');
                    noteItem.classList.add('note-item');

                    const noteTextSpan = document.createElement('span');
                    noteTextSpan.classList.add('note-text');
                    noteTextSpan.textContent = note;
                    noteItem.appendChild(noteTextSpan);

                    const deleteButton = document.createElement('button');
                    deleteButton.classList.add('delete-note-button', 'icon-button');
                    deleteButton.setAttribute('aria-label', 'Delete note');
                    deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                    deleteButton.addEventListener('click', () => deleteNote(index));
                    noteItem.appendChild(deleteButton);

                    notesList.appendChild(noteItem);
                });
            }
        }

        function addNote() {
            const noteText = noteInput ? noteInput.value.trim() : '';
            if (noteText) {
                notes.unshift(noteText);
                saveNotes();
                renderNotes();
                if (noteInput) noteInput.value = '';
            }
        }

        function deleteNote(index) {
            notes.splice(index, 1);
            saveNotes();
            renderNotes();
        }

        if (saveNoteButton) {
            saveNoteButton.addEventListener('click', addNote);
        }
        if (noteInput) {
            noteInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    addNote();
                }
            });
        }

        // --- Motivational Journal Logic ---
        const motivationalQuotes = [
            { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { quote: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { quote: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
            { quote: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
            { quote: "The best way to predict the future is to create it.", author: "Peter Drucker" },
            { quote: "Success is not final, failure is not fatal: It is the courage to continue that counts.", author: "Winston S. Churchill" },
            { quote: "The mind is everything. What you think you become.", author: "Buddha" },
            { quote: "Strive not to be a success, but rather to be of value.", author: "Albert Einstein" },
            { quote: "The only limit to our realization of tomorrow will be our doubts of today.", author: "Franklin D. Roosevelt" }
        ];

        const motivationalQuoteDisplay = document.getElementById('motivational-quote');
        const quoteAuthorDisplay = document.getElementById('quote-author');
        const dailyJournalInputMJ = document.getElementById('daily-journal-input'); // Renamed to avoid conflict
        const journalDateSpanMJ = document.getElementById('journal-date'); // Renamed to avoid conflict
        const pastJournalEntriesContainer = document.getElementById('past-journal-entries');
        const noPastEntriesMessage = document.getElementById('no-past-entries-message');

        function displayRandomQuote() {
            if (motivationalQuoteDisplay && quoteAuthorDisplay) {
                const randomIndex = Math.floor(Math.random() * motivationalQuotes.length);
                const randomQuote = motivationalQuotes[randomIndex];
                motivationalQuoteDisplay.textContent = `"${randomQuote.quote}"`;
                quoteAuthorDisplay.textContent = `- ${randomQuote.author}`;
            }
        }

        function getFormattedDate(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0]; // YYYY-MM-DD
        }

        function loadJournalEntry(dateKey) {
            const entry = localStorage.getItem(`journal-${dateKey}`);
            return entry ? JSON.parse(entry) : null;
        }

        function saveJournalEntry(dateKey, content) {
            localStorage.setItem(`journal-${dateKey}`, JSON.stringify({ content: content, timestamp: Date.now() }));
        }

        function renderJournal() {
            const today = new Date();
            const todayKey = getDateKey(today);
            const todayFormatted = getFormattedDate(today);

            if (journalDateSpanMJ) {
                journalDateSpanMJ.textContent = todayFormatted;
            }

            const todayEntry = loadJournalEntry(todayKey);
            if (dailyJournalInputMJ) {
                dailyJournalInputMJ.value = todayEntry ? todayEntry.content : '';
                dailyJournalInputMJ.readOnly = false; // Ensure today's entry is editable
                dailyJournalInputMJ.addEventListener('input', () => {
                    saveJournalEntry(todayKey, dailyJournalInputMJ.value);
                });
            }

            if (pastJournalEntriesContainer) {
                pastJournalEntriesContainer.innerHTML = ''; // Clear previous entries
            }

            const allJournalKeys = Object.keys(localStorage).filter(key => key.startsWith('journal-'));
            const sortedKeys = allJournalKeys.sort().reverse(); // Sort descending by date

            let hasPastEntries = false;
            sortedKeys.forEach(key => {
                const dateKey = key.replace('journal-', '');
                if (dateKey !== todayKey) {
                    const entry = loadJournalEntry(dateKey);
                    if (entry) {
                        const entryDate = new Date(dateKey);
                        const entryFormattedDate = getFormattedDate(entryDate);

                        const entryDiv = document.createElement('div');
                        entryDiv.classList.add('journal-entry-item', 'locked'); // Always locked for past entries
                        entryDiv.innerHTML = `
                            <h4>${entryFormattedDate}</h4>
                            <p>${entry.content.replace(/\n/g, '<br>')}</p>
                        `;
                        if (pastJournalEntriesContainer) {
                            pastJournalEntriesContainer.appendChild(entryDiv);
                        }
                        hasPastEntries = true;
                    }
                }
            });

            if (noPastEntriesMessage) {
                noPastEntriesMessage.style.display = hasPastEntries ? 'none' : 'block';
            }
        }


        // --- Initializations ---
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('motivational-journal-section'); // Default tab to Motivational Journal

            updateConvertButtonStateImgPdf();
            if (convertBtnImgPdf) convertBtnImgPdf.addEventListener('click', convertImagesToPdf);

            handlePdfFileSelection();
            updateConvertPdfToImgButtonState();

            if (convertTextToPdfBtn) convertTextToPdfBtn.addEventListener('click', async () => {
                const textContent = textToPdfInput ? textToPdfInput.value.trim() : '';
                if (textContent === '') {
                    showMessageTextPdf('error', '<i class="fas fa-exclamation-triangle"></i> Please enter some text to convert!', true);
                    return;
                }
                // Existing logic for text to PDF conversion
            });

            renderSectionOrderList();
            updateResumePreview();

            // Dispatch input event for initial values to update preview
            const inputs = document.querySelectorAll('#resume-builder-section .form-input');
            inputs.forEach(input => {
                const event = new Event('input', { bubbles: true });
                input.dispatchEvent(event);
            });

            // Render dynamic sections initially
            renderDynamicSection('experience-entries', 'experience', experienceTemplate);
            renderDynamicSection('education-entries', 'education', educationTemplate);
            renderDynamicSection('project-entries', 'projects', projectTemplate);
            renderDynamicSection('award-entries', 'awards', awardTemplate);


            if (listLineHeightValueSpan && listLineHeightInput) listLineHeightValueSpan.textContent = `${listLineHeightInput.value}x`;

            loadNotes();

            // Initialize new PDF tool sections
            handleRotatePdfFileSelection();
            updateRotatePdfButtonState();

            handlePageNumbersPdfFileSelection();
            updateAddPageNumbersButtonState();

            handleWatermarkPdfFileSelection();
            updateAddWatermarkButtonState();
            if (watermarkOpacityInput && watermarkOpacityValueSpan) watermarkOpacityValueSpan.textContent = `${watermarkOpacityInput.value}%`;

            handleCropPdfFileSelection();
            updateCropPdfButtonState();

            handleAddTextPdfFileSelection();
            updateAddTextToPdfButtonState();

            // Initial call for Motivational Journal
            displayRandomQuote();
            renderJournal();
        });
    </script>
</body>
</html>
